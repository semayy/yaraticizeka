<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaratıcı Zeka Profili</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=Orbitron:wght@400;500;700&display=swap');
        
        :root {
            --neon-cyan: #00f6ff;
            --neon-purple: #a855f7;
            --neon-pink: #f472b6;
            --dark-bg: #0a0f1f;
            --dark-card: #111827;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(0, 246, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(168, 85, 247, 0.1) 0%, transparent 40%);
            min-height: 100vh;
            overflow-x: hidden;
            color: #e2e8f0;
        }
        
        .tech-font { font-family: 'Orbitron', sans-serif; }
        
        .card {
            perspective: 1500px;
            min-height: 520px;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner { transform: rotateY(180deg); }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            box-shadow: 0 0 20px rgba(0, 246, 255, 0.2), 0 0 40px rgba(168, 85, 247, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 2px solid;
            background: linear-gradient(145deg, #1a243a, var(--dark-card));
        }
        
        .card-front { border-image: linear-gradient(45deg, var(--neon-cyan), var(--neon-purple)) 1; }
        .card-back { border-image: linear-gradient(45deg, var(--neon-purple), var(--neon-pink)) 1; transform: rotateY(180deg); }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(0, 246, 255, 0.15);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
            transition: width 0.5s ease;
            border-radius: 4px;
            box-shadow: 0 0 8px var(--neon-cyan);
        }
        
        .btn-nav {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .btn-nav:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 0 20px var(--neon-cyan);
            border-color: var(--neon-cyan);
        }
        
        .btn-nav:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(80%); }
        
        .stars {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }
        
        @keyframes twinkle {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 0.8; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        
        .glow { animation: glow 3s infinite alternate; }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(0, 246, 255, 0.4), 0 0 30px rgba(168, 85, 247, 0.3); }
            to { box-shadow: 0 0 35px rgba(0, 246, 255, 0.6), 0 0 50px rgba(168, 85, 247, 0.5); }
        }
        
        .floating { animation: floating 5s infinite ease-in-out; }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        .task-input {
            background-color: #1e293b;
            color: #94a3b8;
            border: 1px solid #334155;
            border-radius: 0.5rem;
            padding: 0.75rem;
            width: 100%;
            transition: all 0.3s ease;
        }
        .task-input:focus {
            outline: none;
            border-color: var(--neon-cyan);
            background-color: #0f172a;
            box-shadow: 0 0 15px rgba(0, 246, 255, 0.4);
        }
        .task-textarea { resize: vertical; min-height: 120px; }

        .quiz-option {
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .quiz-option:hover {
            background-color: rgba(56, 189, 248, 0.2);
            border-color: var(--neon-cyan);
        }
        .quiz-option.selected {
            background-color: rgba(0, 246, 255, 0.3);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 246, 255, 0.4);
        }
        
        .shape-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .shape-option:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--neon-cyan));
        }
        .shape-option.selected {
             transform: scale(1.1);
             filter: drop-shadow(0 0 15px var(--neon-cyan));
        }

        .gemini-feedback {
            margin-top: 1rem;
            padding: 1rem;
            background-color: rgba(0, 246, 255, 0.05);
            border: 1px solid rgba(0, 246, 255, 0.2);
            border-radius: 0.5rem;
            text-align: left;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .loader {
            border: 4px solid #334155;
            border-top: 4px solid var(--neon-cyan);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 31, 0.8);
            backdrop-filter: blur(8px);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--dark-bg);
            border: 1px solid var(--neon-cyan);
            box-shadow: 0 0 40px rgba(0, 246, 255, 0.3);
            border-radius: 1.5rem;
            padding: 2rem;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        /* Tab Styling */
        .tab-button {
            background-color: #1e293b;
            color: #94a3b8;
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }
        .tab-button.active, .tab-button:hover {
            background-color: var(--dark-card);
            color: var(--neon-cyan);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 246, 255, 0.3);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Archetype Card Styling */
        .archetype-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid #334155;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease-in-out;
            backdrop-filter: blur(3px);
        }
        .archetype-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 0 25px rgba(0, 246, 255, 0.3), 0 0 10px rgba(168, 85, 247, 0.2);
            border-color: var(--neon-cyan);
            background: rgba(30, 41, 59, 0.8);
        }
        .archetype-icon-container {
            margin-bottom: 1rem;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--neon-cyan);
        }
        .archetype-icon-container svg {
            width: 50px;
            height: 50px;
            transition: all 0.3s ease;
        }
        .archetype-card:hover .archetype-icon-container svg {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--neon-cyan));
        }

        /* Voice Assistant Button */
        #voice-assistant-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 40;
            background-color: var(--neon-purple);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px var(--neon-purple);
            transition: all 0.3s ease;
        }
        #voice-assistant-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px var(--neon-purple);
        }
        #voice-assistant-btn.listening {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(168, 85, 247, 0); }
            100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }

        /* Analysis Loader Animation */
        @keyframes pulse-loader {
            0%, 100% { transform: scale(0.6); opacity: 0; }
            50% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-loader-1 { animation: pulse-loader 3s ease-in-out infinite; }
        .animate-pulse-loader-2 { animation: pulse-loader 3s ease-in-out infinite; animation-delay: 1.5s; }
        .animate-spin-slow { animation: spin 4s linear infinite reverse; }

    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 flex flex-col min-h-screen">
    <div class="stars" id="stars"></div>

    <main class="flex-grow">
        <!-- EKRAN 1: GİRİŞ EKRANI -->
        <div id="welcome-screen" class="max-w-5xl mx-auto">
            <div class="bg-slate-900/70 backdrop-blur-sm rounded-3xl p-4 md:p-8 shadow-2xl glow">
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="mb-6 relative">
                        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-500 blur-2xl opacity-30 rounded-full"></div>
                        <h1 class="tech-font text-4xl sm:text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 via-white to-purple-400 relative z-10 text-center" data-lang-key="welcome_title">
                            YARATICI ZEKA PROFİLİ
                        </h1>
                    </div>
                    <div class="w-full max-w-md mx-auto mb-8 relative">
                        <div class="floating mb-8 w-40 h-40 md:w-48 md:h-48 mx-auto">
                            <div id="abstract-shape-container" class="w-full h-full"></div>
                        </div>
                        <p class="text-cyan-200 text-center mb-6 text-base md:text-lg" data-lang-key="welcome_intro">
                            Yaratıcı yaklaşımlarınızı keşfetmek ve potansiyelinizi ortaya çıkarmak için bu yolculuğa çıkın.
                        </p>
                        <div class="bg-slate-900/50 p-6 rounded-xl border border-cyan-700/30 shadow-lg">
                            <label for="user-name" class="block text-cyan-300 mb-2 tech-font" data-lang-key="enter_name">İSİM SOYİSİM:</label>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="user-name" class="task-input flex-grow" placeholder="Unvan ve İsim">
                                <button id="start-assessment" class="btn-nav bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-6 py-3 font-semibold tech-font flex items-center justify-center">
                                    <span data-lang-key="start_button">BAŞLA</span>
                                </button>
                            </div>
                            <p id="name-error" class="text-red-400 text-sm mt-2 text-center hidden">Lütfen başlamadan önce bir isim girin.</p>
                        </div>
                        <div class="mt-8 flex flex-wrap justify-center gap-3">
                            <button class="info-modal-btn btn-nav bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="about">Hakkında</button>
                            <button class="info-modal-btn btn-nav bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="archetypes">Arketipler</button>
                            <button class="info-modal-btn btn-nav bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="contact">İletişim</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- EKRAN 2: DEĞERLENDİRME EKRANI -->
        <div id="assessment-screen" class="max-w-5xl mx-auto hidden">
            <div class="bg-slate-900/70 backdrop-blur-sm rounded-3xl p-4 md:p-8 shadow-2xl">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                     <div class="w-full md:w-1/3">
                        <button id="btn-main-menu" class="btn-nav bg-slate-900 text-cyan-400 border border-cyan-700/50 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-800 tech-font" data-lang-key="main_menu_button">ANA MENÜ</button>
                    </div>
                    <div class="w-full md:w-1/3 text-center order-first md:order-none">
                        <h2 id="stage-title" class="tech-font text-xl text-cyan-300">Aşama 1: Keşif</h2>
                    </div>
                    <div class="w-full md:w-1/3 flex justify-center md:justify-end">
                        <span class="bg-gradient-to-r from-cyan-900/50 to-purple-900/50 text-white py-2 px-4 rounded-full text-sm font-bold tech-font">
                            <span data-lang-key="progress">İLERLEME</span>: <span id="overall-progress-count">1</span>/18
                        </span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="progress-bar"><div class="progress" id="progress-bar" style="width: 5.5%"></div></div>
                </div>
                
                <div class="grid grid-cols-1 gap-8">
                    <div class="card" id="current-card">
                        <div class="card-inner">
                            <div class="card-front p-4 md:p-6 flex flex-col h-full">
                                 <h3 class="text-2xl md:text-3xl font-bold mb-4 tech-font text-cyan-300" id="module-title">Modül Başlığı</h3>
                                 <div class="flex-grow overflow-auto pr-2 flex flex-col justify-center items-center" id="module-content-area">
                                    <!-- Modül içeriği buraya gelecek -->
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-between items-center mt-8 gap-4">
                    <button id="btn-prev" class="btn-nav w-full sm:w-auto bg-slate-900 text-cyan-400 border border-cyan-700/50 rounded-lg px-6 py-3 font-medium flex items-center justify-center">ÖNCEKİ</button>
                    <button id="btn-next" class="btn-nav w-full sm:w-auto bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-6 py-3 font-medium flex items-center justify-center">SONRAKİ</button>
                </div>
            </div>
        </div>

        <!-- EKRAN 3: SONUÇ EKRANI -->
        <div id="results-screen" class="max-w-5xl mx-auto hidden">
             <div class="bg-slate-900/70 backdrop-blur-sm rounded-3xl p-4 md:p-8 shadow-2xl">
                <h1 class="tech-font text-3xl md:text-4xl font-bold text-center mb-2 text-cyan-300" data-lang-key="results_title">Yaratıcı Profiliniz</h1>
                <p class="text-center text-cyan-200 mb-8" id="user-name-results"></p>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
                    <div class="lg:col-span-1 text-center">
                        <h3 class="tech-font text-xl text-purple-300 mb-2" data-lang-key="overall_success">Genel Başarı</h3>
                        <div id="success-percentage" class="text-7xl font-bold text-white tech-font">0%</div>
                    </div>
                    <div class="lg:col-span-2">
                         <canvas id="archetype-chart"></canvas>
                    </div>
                </div>
                
                <div class="mt-8 bg-slate-900/50 p-6 rounded-xl border border-cyan-700/30">
                    <h3 class="tech-font text-xl text-purple-300 mb-3" data-lang-key="profile_analysis">Profil Analizi</h3>
                    <div id="profile-analysis-text" class="text-slate-300 leading-relaxed"></div>
                </div>

                <div class="text-center mt-8">
                     <button id="btn-restart" class="btn-nav bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-8 py-3 font-semibold tech-font" data-lang-key="restart_button">Yeniden Başla</button>
                </div>
             </div>
        </div>
    </main>

    <footer class="text-center text-slate-500 text-xs p-4 mt-auto">
        © 2025 Tüm Hakları Saklıdır. Bu içerik eğitim amaçlıdır.
    </footer>

    <!-- BİLGİ MODALI -->
    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="absolute top-4 right-5 text-slate-400 hover:text-white transition-colors">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="flex flex-wrap justify-center border-b border-slate-700 mb-6">
                <button class="tab-button tech-font py-2 px-6 rounded-t-lg" data-tab="about">Hakkında</button>
                <button class="tab-button tech-font py-2 px-6 rounded-t-lg" data-tab="archetypes">Arketipler</button>
                <button class="tab-button tech-font py-2 px-6 rounded-t-lg" data-tab="contact">İletişim</button>
            </div>
            <div id="tab-content-container">
                <div id="archetypes-content" class="tab-content">
                    <div class="relative">
                        <div id="archetype-carousel-wrapper" class="overflow-hidden">
                            <div id="archetype-carousel" class="flex transition-transform duration-500 ease-in-out">
                                <!-- Archetype Cards will be dynamically inserted here -->
                            </div>
                        </div>
                        <button id="archetype-prev" class="absolute top-1/2 -left-4 -translate-y-1/2 bg-slate-800/50 p-2 rounded-full hover:bg-slate-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed z-10">
                            <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <button id="archetype-next" class="absolute top-1/2 -right-4 -translate-y-1/2 bg-slate-800/50 p-2 rounded-full hover:bg-slate-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed z-10">
                            <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
                <div id="about-content" class="tab-content">
                    <h3 class="tech-font text-2xl text-purple-300 mb-4">Testin Amacı Nedir?</h3>
                    <p class="text-slate-300 leading-relaxed mb-4">Bu profil testi, yaratıcılığınızın hangi yönlerinin daha baskın olduğunu keşfetmenize yardımcı olmak için tasarlanmıştır. Sonuçlar, klinik bir psikolojik değerlendirme değildir; bunun yerine, yaratıcı düşünce süreçlerinizi ve problem çözme yaklaşımlarınızı anlamanız için bir çerçeve sunar.</p>
                    <p class="text-slate-300 leading-relaxed">Mitolojik arketipleri, farklı yaratıcılık türleri için güçlü birer metafor olarak kullanıyoruz. Bu testle amacımız, kendi yaratıcı "süper güçlerinizi" tanımanıza, bu güçleri nasıl daha etkili kullanabileceğinize ve potansiyel gelişim alanlarınıza dair farkındalık kazanmanıza olanak tanımaktır. Bu yolculuk, yaratıcı potansiyelinizi en üst düzeye çıkarmanız için bir başlangıç noktasıdır.</p>
                </div>
                <div id="contact-content" class="tab-content">
                    <p class="text-slate-300 leading-relaxed mb-2">Sorularınız veya geri bildirimleriniz için LinkedIn üzerinden iletişime geçebilirsiniz:</p>
                    <a href="https://linkedin.com/in/semayy" target="_blank" rel="noopener noreferrer" class="text-cyan-400 hover:text-cyan-300 tech-font transition-colors">
                        linkedin.com/in/semayy
                    </a>
                    <p class="text-slate-300 mt-4">Semanur Ayyıldız<br><span class="text-sm text-slate-400">Görsel İletişim Tasarımı ve Dijital Dönüşüm Uzmanı</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- SESLİ ASİSTAN BUTONU -->
    <button id="voice-assistant-btn" title="Sesli Asistanı Başlat">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
    </button>

<script>
// --- GLOBAL DEĞİŞKENLER VE DOM ELEMENTLERİ --- //
// Ekranlar
const welcomeScreen = document.getElementById('welcome-screen');
const assessmentScreen = document.getElementById('assessment-screen');
const resultsScreen = document.getElementById('results-screen');

// Butonlar ve Girdiler
const startAssessmentBtn = document.getElementById('start-assessment');
const userNameInput = document.getElementById('user-name');
const nameError = document.getElementById('name-error');
const btnPrev = document.getElementById('btn-prev');
const btnNext = document.getElementById('btn-next');
const btnMainMenu = document.getElementById('btn-main-menu');
const btnRestart = document.getElementById('btn-restart');

// Değerlendirme Ekranı Elementleri
const stageTitle = document.getElementById('stage-title');
const overallProgressCount = document.getElementById('overall-progress-count');
const progressBar = document.getElementById('progress-bar');
const moduleTitle = document.getElementById('module-title');
const moduleContentArea = document.getElementById('module-content-area');

// Sonuç Ekranı Elementleri
const userNameResults = document.getElementById('user-name-results');
const successPercentage = document.getElementById('success-percentage');
const archetypeChartCanvas = document.getElementById('archetype-chart');
const profileAnalysisText = document.getElementById('profile-analysis-text');
const starsContainer = document.getElementById('stars');

// Modal, Tab & Carousel Elementleri
const infoModal = document.getElementById('info-modal');
const closeModalBtn = document.getElementById('close-modal-btn');
const infoModalBtns = document.querySelectorAll('.info-modal-btn');
const modalTabButtons = infoModal.querySelectorAll('.tab-button');
const modalTabContents = infoModal.querySelectorAll('.tab-content');
const archetypeCarousel = document.getElementById('archetype-carousel');
const archetypePrevBtn = document.getElementById('archetype-prev');
const archetypeNextBtn = document.getElementById('archetype-next');

// Sesli Asistan Elementleri
const voiceAssistantBtn = document.getElementById('voice-assistant-btn');

// Durum (State) Değişkenleri
let currentModuleIndex = 0;
let userAnswers = {};
let userArchetypeScores = {};
let archetypeChart = null;
let archetypeCurrentIndex = 0;

// --- DİL VE VERİ YAPILARI --- //
const translations = {
    tr: {
        welcome_title: "YARATICI ZEKA PROFİLİ",
        welcome_intro: "Yaratıcı yaklaşımlarınızı keşfetmek ve potansiyelinizi ortaya çıkarmak için bu yolculuğa çıkın.",
        enter_name: "İSİM SOYİSİM:",
        start_button: "BAŞLA",
        main_menu_button: "ANA MENÜ",
        progress: "İLERLEME",
        results_title: "Yaratıcı Profiliniz",
        overall_success: "Genel Başarı",
        profile_analysis: "Profil Analizi",
        restart_button: "Yeniden Başla",
        evaluating_feedback: "Değerlendiriliyor...",
        gemini_feedback_title: "Yapay Zeka Geri Bildirimi:",
        gemini_error: "Bir hata oluştu. Lütfen tekrar deneyin.",
        evaluate_ideas_button: "✨ Fikirlerimi Değerlendir",
    }
};

const archetypes = {
    athena: { 
        tr: { name: "Athena", desc: "Stratejik ve mantıksal yaratıcılık. Problemleri analiz eder, planlar ve net çözümler üretir." },
        icon: `<path d="M50 10L80 80H20L50 10Z" stroke-width="5"/><path d="M35 60H65" stroke-width="5"/>`
    },
    apollo: { 
        tr: { name: "Apollo", desc: "Uyum ve estetik yaratıcılık. Güzellik, denge ve düzen arar. Sanatsal ve tasarımsal yetenekleri temsil eder." },
        icon: `<circle cx="50" cy="50" r="30" stroke-width="5"/><circle cx="50" cy="50" r="15" stroke-width="5"/>`
    },
    hermes: { 
        tr: { name: "Hermes", desc: "Çevik ve birleştirici yaratıcılık. Fikirler arasında hızla bağlantı kurar, iletişimde ustadır ve yenilikleri yayar." },
        icon: `<path d="M20 80L50 50L20 20M80 80L50 50L80 20" stroke-width="5"/>`
    },
    hephaestus: { 
        tr: { name: "Hephaestus", desc: "İnşa eden ve üreten yaratıcılık. Soyut fikirleri somut projelere dönüştürür, zanaatkarlık ve mühendislik becerileri yüksektir." },
        icon: `<rect x="20" y="20" width="60" height="60" rx="5" stroke-width="5"/><rect x="35" y="35" width="30" height="30" rx="5" stroke-width="5" fill="currentColor"/>`
    },
    prometheus: { 
        tr: { name: "Prometheus", desc: "Vizyoner ve kural yıkan yaratıcılık. Geleceği şekillendirir, radikal yenilikler peşindedir ve mevcut durumu sorgular." },
        icon: `<path d="M50 10V90 M10 50H90 M25 25L75 75 M25 75L75 25" stroke-width="5" stroke-linecap="round"/>`
    },
    dionysus: { 
        tr: { name: "Dionysus", desc: "Sezgisel ve spontane yaratıcılık. Kuralların dışında düşünür, kaostan beslenir ve beklenmedik fikirler ortaya atar." },
        icon: `<path d="M20 20C40 80 60 10 80 90" stroke-width="5" stroke-linecap="round"/>`
    },
    janus: { 
        tr: { name: "Janus", desc: "Yansıtıcı ve çift yönlü yaratıcılık. Geçmişten ders alıp geleceğe uygular, zıtlıklar arasında denge kurar." },
        icon: `<path d="M50 10V90 M50 50L20 30V70L50 50L80 30V70L50 50" stroke-width="5"/>`
    },
    persephone: { 
        tr: { name: "Persephone", desc: "Dönüştürücü yaratıcılık. Mevcut olanı alır ve ona yepyeni bir anlam veya işlev kazandırır." },
        icon: `<path d="M20 50H80" stroke-width="5"/><path d="M20 50C40 20 60 80 80 50" stroke-width="5" stroke-dasharray="10 5"/>`
    },
    thalia: { 
        tr: { name: "Thalia", desc: "Sosyal ve esprili yaratıcılık. İnsanları bir araya getirir, mizahtan ve oyundan beslenir, sosyal zekası yüksektir." },
        icon: `<circle cx="30" cy="30" r="15" stroke-width="5"/><circle cx="70" cy="30" r="15" stroke-width="5"/><path d="M30 70C40 50 60 50 70 70" stroke-width="5" stroke-linecap="round"/>`
    },
    artemis: { 
        tr: { name: "Artemis", desc: "Odaklanmış ve hedefe yönelik yaratıcılık. Belirli bir hedefe kilitlenir ve o hedefe ulaşmak için hassas ve etkili çözümler geliştirir." },
        icon: `<path d="M90 50L30 50 M70 30L90 50L70 70" stroke-width="5" stroke-linecap="round"/><circle cx="20" cy="50" r="5" fill="currentColor"/>`
    },
};

const assessmentModules = [
    // --- AŞAMA 1: KEŞİF ---
    { stage: 1, type: 'task', archetypes: ['athena', 'dionysus'], tr: { title: "Modül 1: Strateji vs. Sezgi", instruction: "Bir müzik festivali düzenliyorsunuz. A) Festivalin ana stratejisini (hedef kitle, bütçe) 2-3 cümlede özetleyin. B) Festival için 3 tane çılgın ve spontane etkinlik fikri listeleyin." } },
    { stage: 1, type: 'task', archetypes: ['apollo', 'hephaestus'], tr: { title: "Modül 2: Uyum vs. Yapı", instruction: "Yeni bir akıllı saat tasarlıyorsunuz. A) Saatin logosu için bir konsept açıklayın. B) Saatin en önemli 3 teknik özelliğini listeleyin." } },
    { stage: 1, type: 'task', archetypes: ['hermes', 'janus'], tr: { title: "Modül 3: Çeviklik vs. Yansıtma", instruction: "A) 'Bulut', 'Anahtar', 'Müzik' kelimeleri arasında bir bağlantı kurun. B) Geçmişte başarısız olan bir projeden çıkarılacak bir dersi yazın." } },
    { stage: 1, type: 'task', archetypes: ['prometheus', 'artemis'], tr: { title: "Modül 4: Vizyon vs. Odak", instruction: "A) 2050'de eğitimin nasıl olacağını hayal edin. B) Bu vizyondaki tek bir soruna (örn: eşitsizlik) odaklanıp bir çözüm önerin." } },
    { stage: 1, type: 'task', archetypes: ['persephone', 'thalia'], tr: { title: "Modül 5: Dönüşüm vs. Sosyal Zeka", instruction: "A) Eski bir gazeteyi hangi farklı amaçlarla kullanabilirsiniz? 3 fikir yazın. B) [Rastgele bir resim gösterilecek] Bu resme komik bir başlık bulun." } },
    { stage: 1, type: 'intro', tr: { title: "Modül 6: Aşama 1 Tamamlandı", instruction: "Keşif aşamasını tamamladınız. Şimdi bilgilerinizi test etme zamanı. Bir sonraki aşama, senaryo bazlı sorulardan oluşan bir quiz'dir." } },
    
    // --- AŞAMA 2: SINAMA (QUIZ) ---
    { stage: 2, type: 'quiz', tr: { question: "Bir ürünün beklenmedik bir şekilde popülerliğini kaybetmesi durumunda, hangi yaklaşım öncelikli olmalıdır?", options: ["Pazar verilerini analiz edip strateji oluşturmak.", "Hızla yeni bir pazarlama kampanyası denemek.", "Ürünün tasarımını tamamen değiştirmek."], answer: 0, archetype: "athena" } },
    { stage: 2, type: 'quiz', tr: { question: "Bir projenin estetik ve kullanıcı deneyimi eleştiriliyorsa, hangi arketipin yeteneğine en çok ihtiyaç duyulur?", options: ["Mühendislik ve yapısal sağlamlık.", "Uyum, denge ve sanatsal vizyon.", "Geçmiş hatalardan ders çıkarma."], answer: 1, archetype: "apollo" } },
    { stage: 2, type: 'quiz', tr: { question: "Kriz anında hızlı ve yaratıcı çözümler bulmak için hangi arketip en uygundur?", options: ["Gelecek için uzun vadeli planlar yapan.", "Farklı fikirler arasında anında köprü kuran.", "Belirli bir hedefe odaklanıp şaşmayan."], answer: 1, archetype: "hermes" } },
    { stage: 2, type: 'quiz', tr: { question: "Soyut bir konsepti, çalışan bir prototipe dönüştürme görevi en çok hangi arketipe aittir?", options: ["Prometheus", "Hephaestus", "Dionysus"], answer: 1, archetype: "hephaestus" } },
    { stage: 2, type: 'quiz', tr: { question: "Mevcut bir teknolojiyi alıp, kimsenin aklına gelmeyen yepyeni bir alanda kullanma fikri hangi arketipi yansıtır?", options: ["Persephone", "Janus", "Apollo"], answer: 0, archetype: "persephone" } },
    { stage: 2, type: 'intro', tr: { title: "Modül 12: Aşama 2 Tamamlandı", instruction: "Quiz aşamasını başarıyla geçtiniz. Son aşama, soyut düşünme ve desen tanıma yeteneğinizi ölçecek olan şekil eşleştirme testidir." } },

    // --- AŞAMA 3: SENTEZ (ŞEKİL EŞLEŞTİRME) ---
    { stage: 3, type: 'shape', archetype: 'apollo', tr: { title: "Modül 13: Simetriyi Bul" }, data: { problem: `<path d="M50 10 V 90 M 10 50 H 50" stroke="white" stroke-width="3"/>`, options: [`<path d="M50 10 V 90 M 90 50 H 50" stroke="white" stroke-width="3"/>`, `<path d="M10 10 L 50 50 L 10 90" stroke="white" stroke-width="3"/>`], answer: 0 } },
    { stage: 3, type: 'shape', archetype: 'hephaestus', tr: { title: "Modül 14: Parçayı Tamamla" }, data: { problem: `<path d="M20 20 H 80 V 80 H 60 V 40 H 40" stroke="white" stroke-width="3"/>`, options: [`<path d="M40 40 V 80 H 20 V 20" stroke="white" stroke-width="3"/>`, `<circle cx="50" cy="60" r="10" stroke="white" stroke-width="3"/>`], answer: 0 } },
    { stage: 3, type: 'shape', archetype: 'dionysus', tr: { title: "Modül 15: Deseni Boz" }, data: { problem: `<g><circle cx="25" cy="25" r="10"/><circle cx="75" cy="25" r="10"/><circle cx="25" cy="75" r="10"/><circle cx="75" cy="75" r="10"/></g>`, options: [`<circle cx="50" cy="50" r="10"/>`, `<rect x="40" y="40" width="20" height="20"/>`], answer: 1 } },
    { stage: 3, type: 'shape', archetype: 'hermes', tr: { title: "Modül 16: Köprüyü Kur" }, data: { problem: `<g><circle cx="25" cy="50" r="15"/><rect x="65" y="35" width="30" height="30"/></g>`, options: [`<path d="M40 50 H 65"/>`, `<path d="M25 65 C 40 80, 60 80, 75 65"/>`], answer: 0 } },
    { stage: 3, type: 'shape', archetype: 'artemis', tr: { title: "Modül 17: Hedefi Bul" }, data: { problem: `<g><circle cx="50" cy="50" r="40" stroke-dasharray="5 5"/><circle cx="50" cy="50" r="30" stroke-dasharray="5 5"/><circle cx="50" cy="50" r="20" stroke-dasharray="5 5"/></g>`, options: [`<circle cx="50" cy="50" r="5"/>`, `<path d="M50 10 V 90 M10 50 H 90"/>`], answer: 1 } },
    { stage: 3, type: 'shape', archetype: 'prometheus', tr: { title: "Modül 18: Yeni Formu Yarat" }, data: { problem: `<g><rect x="20" y="40" width="20" height="20"/><circle cx="80" cy="50" r="10"/></g>`, options: [`<rect x="50" y="40" width="20" height="20"/>`, `<path d="M40 50 C 50 20, 70 80, 80 50"/>`], answer: 1 } }
];

// --- GEMINI API YARDIMCI FONKSİYONU --- //
async function callGeminiAPI(prompt) {
    const apiKey = ""; 
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
    
    const payload = {
        contents: [{ role: "user", parts: [{ text: prompt }] }]
    };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error(`API call failed with status: ${response.status}`);
        }

        const result = await response.json();
        
        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
            return result.candidates[0].content.parts[0].text;
        } else {
            throw new Error("Invalid response structure from API.");
        }
    } catch (error) {
        console.error("Error calling Gemini API:", error);
        throw error;
    }
}


// --- UYGULAMA MANTIĞI --- //

/** Uygulamayı başlatır veya sıfırlar */
function initializeApp() {
    currentModuleIndex = 0;
    userAnswers = {};
    userArchetypeScores = Object.keys(archetypes).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});
    
    showScreen('assessment-screen');
    loadModule(currentModuleIndex);
}

/** Belirtilen indeksteki modülü yükler */
function loadModule(index) {
    const module = assessmentModules[index];
    
    stageTitle.textContent = `Aşama ${module.stage}: ${getStageName(module.stage)}`;
    overallProgressCount.textContent = `${index + 1}/${assessmentModules.length}`;
    progressBar.style.width = `${((index + 1) / assessmentModules.length) * 100}%`;
    moduleTitle.textContent = module.tr.title;
    moduleContentArea.innerHTML = '';

    switch(module.type) {
        case 'intro': createIntroModule(module); break;
        case 'task': createTaskModule(module, index); break;
        case 'quiz': createQuizModule(module, index); break;
        case 'shape': createShapeModule(module, index); break;
    }
    updateNavButtons();
}

/** Tanıtım modülü arayüzünü oluşturur */
function createIntroModule(module) {
    moduleContentArea.innerHTML = `<p class="text-center text-lg text-slate-300 max-w-lg">${module.tr.instruction}</p>`;
}

/** Görev modülü arayüzünü (Gemini butonu ile) oluşturur */
function createTaskModule(module, index) {
    const savedAnswer = userAnswers[index] || "";
    moduleContentArea.innerHTML = `
        <div class="w-full max-w-xl text-center">
            <p class="text-slate-300 mb-4">${module.tr.instruction}</p>
            <textarea class="task-input task-textarea" data-module-index="${index}">${savedAnswer}</textarea>
            <button class="btn-nav mt-4 bg-gradient-to-r from-teal-400 to-cyan-600 text-white rounded-lg px-5 py-2 gemini-eval-button" data-module-index="${index}">
                ${translations.tr.evaluate_ideas_button}
            </button>
            <div class="gemini-feedback-container mt-4"></div>
        </div>
    `;
}

/** Quiz modülü arayüzünü oluşturur */
function createQuizModule(module, index) {
    const savedAnswer = userAnswers[index];
    let optionsHTML = module.tr.options.map((option, i) => `
        <div class="quiz-option w-full text-left p-4 rounded-lg ${savedAnswer === i ? 'selected' : ''}" data-option-index="${i}">
            <span class="font-bold tech-font mr-2">${String.fromCharCode(65 + i)}:</span>
            <span>${option}</span>
        </div>
    `).join('');

    moduleContentArea.innerHTML = `
        <div class="w-full max-w-2xl text-center">
            <p class="text-slate-300 mb-6 text-lg">${module.tr.question}</p>
            <div class="flex flex-col gap-4" id="quiz-options-container" data-module-index="${index}">${optionsHTML}</div>
        </div>
    `;
}

/** Şekil eşleştirme modülü arayüzünü oluşturur */
function createShapeModule(module, index) {
    const savedAnswer = userAnswers[index];
    const optionsHTML = module.data.options.map((option, i) => `
        <div class="shape-option p-4 ${savedAnswer === i ? 'selected' : ''}" data-option-index="${i}">
            <svg viewBox="0 0 100 100" class="w-24 h-24" fill="none" stroke="white" stroke-width="3">${option}</svg>
        </div>
    `).join('');

    moduleContentArea.innerHTML = `
         <div class="w-full max-w-2xl text-center">
            <p class="text-slate-300 mb-4 text-lg">Problemi en iyi çözen veya tamamlayan şekli seçin.</p>
            <div class="mb-8 p-4"><svg viewBox="0 0 100 100" class="w-32 h-32 mx-auto" fill="none" stroke="var(--neon-cyan)" stroke-width="3">${module.data.problem}</svg></div>
            <div class="flex justify-center gap-8" id="shape-options-container" data-module-index="${index}">${optionsHTML}</div>
        </div>
    `;
}

/** Navigasyon butonlarının durumunu günceller */
function updateNavButtons() {
    btnPrev.disabled = currentModuleIndex === 0;
    btnNext.textContent = currentModuleIndex === assessmentModules.length - 1 ? 'SONUÇLARI GÖR' : 'SONRAKİ';
}

/** Sonuçları hesaplar ve gösterir */
async function showResults() {
    let correctQuizCount = 0;
    let correctShapeCount = 0;
    const totalQuizzes = assessmentModules.filter(m => m.type === 'quiz').length;
    const totalShapes = assessmentModules.filter(m => m.type === 'shape').length;

    userArchetypeScores = Object.keys(archetypes).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});

    assessmentModules.forEach((module, index) => {
        const answer = userAnswers[index];
        if (module.type === 'task' && answer && answer.trim() !== "") {
            module.archetypes.forEach(arc => userArchetypeScores[arc]++);
        }
        if (module.type === 'quiz' && answer === module.answer) {
            correctQuizCount++;
            userArchetypeScores[module.archetype]++;
        }
        if (module.type === 'shape' && answer === module.data.answer) {
            correctShapeCount++;
            userArchetypeScores[module.archetype]++;
        }
    });

    const totalSuccess = totalQuizzes + totalShapes > 0 ? ((correctQuizCount + correctShapeCount) / (totalQuizzes + totalShapes)) * 100 : 0;
    
    userNameResults.textContent = userNameInput.value.trim();
    successPercentage.textContent = `${Math.round(totalSuccess)}%`;
    
    createRadarChart();
    await generateProfileAnalysis();

    showScreen('results-screen');
}

/** Radar grafiğini oluşturur */
function createRadarChart() {
    if (archetypeChart) {
        archetypeChart.destroy();
    }
    const labels = Object.values(archetypes).map(a => a.tr.name);
    const data = Object.values(userArchetypeScores);

    archetypeChart = new Chart(archetypeChartCanvas, {
        type: 'radar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Yaratıcı Profiliniz',
                data: data,
                backgroundColor: 'rgba(0, 246, 255, 0.2)',
                borderColor: 'rgba(0, 246, 255, 1)',
                pointBackgroundColor: 'rgba(0, 246, 255, 1)',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                r: {
                    angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                    grid: { color: 'rgba(255, 255, 255, 0.2)' },
                    pointLabels: { color: '#e2e8f0', font: { size: 12 } },
                    ticks: { display: false, stepSize: 1 }
                }
            },
            plugins: { legend: { display: false } }
        }
    });
}

/** Gemini ile kişiselleştirilmiş profil analiz metnini oluşturur */
async function generateProfileAnalysis() {
    const analysisContainer = document.getElementById('profile-analysis-text');
    
    const analysisLoaderHTML = `
        <div class="text-center p-4">
            <div class="relative w-24 h-24 mx-auto mb-4">
                <div class="absolute inset-0 rounded-full border-2 border-cyan-500/30 animate-pulse-loader-1"></div>
                <div class="absolute inset-0 rounded-full border-2 border-purple-500/30 animate-pulse-loader-2"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <svg class="w-10 h-10 text-cyan-300 animate-spin-slow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.293 2.293M17.707 5.293L15.414 7.586m-3.414.414L9.586 9.586m6.414 6.414l-2.293 2.293M12 12a2 2 0 100-4 2 2 0 000 4zm0 0a2 2 0 100 4 2 2 0 000-4z" />
                    </svg>
                </div>
            </div>
            <p class="tech-font text-lg text-cyan-200 animate-pulse">Analiziniz hazırlanıyor...</p>
            <p class="text-slate-400 text-sm">Lütfen ekrandan ayrılmayın.</p>
        </div>
    `;
    
    analysisContainer.innerHTML = analysisLoaderHTML;

    const sortedArchetypes = Object.entries(userArchetypeScores)
        .sort(([,a],[,b]) => b-a)
        .slice(0, 3)
        .map(([key, score]) => `${archetypes[key].tr.name}: ${score} puan`);

    const prompt = `Bir yaratıcılık koçu olarak, bir kullanıcının yaratıcı zeka profili test sonuçlarını analiz et. Kullanıcının en yüksek puan aldığı ilk 3 mitolojik arketip şunlar: ${sortedArchetypes.join(', ')}. Bu sonuçlara dayanarak, kullanıcının en güçlü 2-3 yaratıcı yönünü, bu yönlerin birbiriyle nasıl bir sinerji oluşturduğunu ve potansiyel gelişim alanlarını açıklayan, teşvik edici ve kişisel bir analiz metni yaz. Analizi 2-3 paragrafta özetle.`;

    try {
        const analysis = await callGeminiAPI(prompt);
        analysisContainer.innerHTML = `<p>${analysis}</p>`;
    } catch (error) {
        // Hata durumunda, isteğe göre, hata mesajı yerine yükleniyor animasyonunu göstermeye devam et
        analysisContainer.innerHTML = analysisLoaderHTML;
    }
}

/** Gemini ile görev cevaplarını değerlendirir */
async function handleIdeaEvaluation(event) {
    const button = event.target;
    const moduleIndex = parseInt(button.dataset.moduleIndex);
    const module = assessmentModules[moduleIndex];
    const textarea = document.querySelector(`textarea[data-module-index="${moduleIndex}"]`);
    const ideas = textarea.value;
    const feedbackContainer = button.nextElementSibling;

    if (!ideas.trim()) return;

    feedbackContainer.innerHTML = `<div class="loader"></div><p>${translations.tr.evaluating_feedback}</p>`;
    button.disabled = true;

    const prompt = `Bir yaratıcılık eğitmeni olarak, kullanıcının şu göreve verdiği cevabı değerlendir: "${module.tr.instruction}". Cevap: "${ideas}". Cevabı, görevin ilişkili olduğu ${module.archetypes.map(a => archetypes[a].tr.name).join(' ve ')} arketipleri açısından analiz et. Güçlü yönleri ve gelişim alanlarını belirten kısa, yapıcı bir geri bildirim yaz.`;

    try {
        const feedback = await callGeminiAPI(prompt);
        feedbackContainer.innerHTML = `<div class="gemini-feedback"><strong>${translations.tr.gemini_feedback_title}</strong><br>${feedback}</div>`;
    } catch (error) {
        feedbackContainer.innerHTML = `<div class="gemini-feedback text-red-400">${translations.tr.gemini_error}</div>`;
    } finally {
        button.disabled = false;
    }
}

/** Aşama ismini döndürür */
function getStageName(stage) {
    if (stage === 1) return "Keşif";
    if (stage === 2) return "Sınama";
    if (stage === 3) return "Sentez";
    return "";
}

/** Arka plan yıldızlarını oluşturur */
function createStars() {
    const starsContainer = document.getElementById('stars');
    if (!starsContainer || starsContainer.children.length > 0) return;
    for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        const size = Math.random() * 2;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.left = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 4}s`;
        star.style.animationDuration = `${3 + Math.random() * 3}s`;
        starsContainer.appendChild(star);
    }
}

/** Arketip kartlarını oluşturur */
function createArchetypeCards() {
    const container = document.getElementById('archetype-carousel');
    if (!container || container.children.length > 0) return; // Sadece bir kere oluştur
    
    let cardsHTML = '';
    for (const key in archetypes) {
        const archetype = archetypes[key];
        cardsHTML += `
            <div class="flex-shrink-0 w-full sm:w-1/2 lg:w-1/3 p-3">
                <div class="archetype-card h-full flex flex-col">
                    <div class="archetype-icon-container">
                        <svg viewBox="0 0 100 100" fill="none" stroke="currentColor">${archetype.icon}</svg>
                    </div>
                    <h4 class="tech-font text-purple-300 text-lg mb-2">${archetype.tr.name}</h4>
                    <p class="text-slate-400 text-sm leading-relaxed">${archetype.tr.desc}</p>
                </div>
            </div>
        `;
    }
    container.innerHTML = cardsHTML;
}

/** Arketip karuselini ayarlar */
function setupArchetypeCarousel() {
    const totalItems = Object.keys(archetypes).length;

    function getItemsPerPage() {
        if (window.innerWidth >= 1024) return 3;
        if (window.innerWidth >= 640) return 2;
        return 1;
    }

    function updateCarousel() {
        const itemsPerPage = getItemsPerPage();
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        
        if (archetypeCurrentIndex >= totalPages) {
            archetypeCurrentIndex = totalPages - 1;
        }
        if (archetypeCurrentIndex < 0) {
            archetypeCurrentIndex = 0;
        }

        const offset = -archetypeCurrentIndex * 100;
        archetypeCarousel.style.transform = `translateX(${offset}%)`;

        archetypePrevBtn.disabled = archetypeCurrentIndex === 0;
        archetypeNextBtn.disabled = archetypeCurrentIndex >= totalPages - 1;
    }

    archetypeNextBtn.addEventListener('click', () => {
        archetypeCurrentIndex++;
        updateCarousel();
    });

    archetypePrevBtn.addEventListener('click', () => {
        archetypeCurrentIndex--;
        updateCarousel();
    });

    window.addEventListener('resize', updateCarousel);
    updateCarousel();
}


/** 3D şekli başlatır */
function initAbstractShape() {
    const container = document.getElementById('abstract-shape-container');
    if (!container || container.children.length > 0) return;
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);
    const geometry = new THREE.TorusKnotGeometry(1, 0.3, 100, 16);
    const material = new THREE.MeshStandardMaterial({ color: 0x9333ea, metalness: 0.7, roughness: 0.2, emissive: 0x00f6ff, emissiveIntensity: 0.2 });
    const shape = new THREE.Mesh(geometry, material);
    scene.add(shape);
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    const pointLight = new THREE.PointLight(0xffffff, 1);
    pointLight.position.set(5, 5, 5);
    scene.add(pointLight);
    camera.position.z = 3.5;
    function animate() {
        requestAnimationFrame(animate);
        shape.rotation.x += 0.003;
        shape.rotation.y += 0.005;
        renderer.render(scene, camera);
    }
    animate();
}

function showScreen(screenId) {
    welcomeScreen.style.display = 'none';
    assessmentScreen.style.display = 'none';
    resultsScreen.style.display = 'none';
    document.getElementById(screenId).style.display = 'block';
}

// --- SESLİ ASİSTAN MANTIĞI --- //
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;
if(SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onstart = () => {
        voiceAssistantBtn.classList.add('listening');
    };

    recognition.onend = () => {
        voiceAssistantBtn.classList.remove('listening');
    };

    recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        voiceAssistantBtn.classList.remove('listening');
    };

    recognition.onresult = (event) => {
        const command = event.results[0][0].transcript.toLowerCase().trim();
        processVoiceCommand(command);
    };
}

function speak(text) {
    if ('speechSynthesis' in window) {
        // Mevcut konuşmayı iptal et
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'tr-TR';
        utterance.rate = 1.1;
        window.speechSynthesis.speak(utterance);
    }
}

function processVoiceCommand(command) {
    console.log(`Command received: ${command}`);
    if (command.includes('test nedir') || command.includes('amaç ne')) {
        const aboutText = document.querySelector('#about-content').textContent;
        speak("Elbette, testin amacı hakkında bilgi veriyorum. " + aboutText);
    } else if (command.includes('arketipler nelerdir')) {
        const archetypeNames = Object.values(archetypes).map(a => a.tr.name).join(', ');
        speak(`Toplam 10 arketip bulunuyor: ${archetypeNames}. Detaylı bilgi için bir arketipin adını söyleyebilirsiniz.`);
    } else if (command.includes('nasıl başlarım')) {
        speak("Başlamak için adınızı yazın ve başla butonuna tıklayın.");
    } else if (command.includes('yardım')) {
        speak("Bana 'test nedir', 'arketipler nelerdir', 'nasıl başlarım' veya belirli bir arketipin adını sorabilirsiniz. Örneğin, 'Athena arketipi nedir?'");
    } else {
        let found = false;
        for (const key in archetypes) {
            const archetype = archetypes[key];
            if (command.includes(archetype.tr.name.toLowerCase())) {
                speak(`${archetype.tr.name}: ${archetype.tr.desc}`);
                found = true;
                break;
            }
        }
        if (!found) {
            speak("Üzgünüm, bu komutu anlayamadım. 'Yardım' diyerek mevcut komutları öğrenebilirsiniz.");
        }
    }
}


// --- OLAY DİNLEYİCİLERİ (EVENT LISTENERS) --- //
document.addEventListener('DOMContentLoaded', () => {
    createStars();
    initAbstractShape();
    createArchetypeCards();
    setupArchetypeCarousel();
    showScreen('welcome-screen');
});

startAssessmentBtn.addEventListener('click', () => {
    const userName = userNameInput.value.trim();
    if (!userName) {
        nameError.classList.remove('hidden');
        userNameInput.classList.add('border-red-500');
        userNameInput.focus();
        return;
    }
    initializeApp();
});

userNameInput.addEventListener('input', () => {
    if (userNameInput.value.trim() !== '') {
        nameError.classList.add('hidden');
        userNameInput.classList.remove('border-red-500');
    }
});


btnNext.addEventListener('click', () => {
    const taskTextarea = document.querySelector(`textarea[data-module-index="${currentModuleIndex}"]`);
    if (taskTextarea) {
        userAnswers[currentModuleIndex] = taskTextarea.value;
    }

    if (currentModuleIndex < assessmentModules.length - 1) {
        currentModuleIndex++;
        loadModule(currentModuleIndex);
    } else {
        showResults();
    }
});

btnPrev.addEventListener('click', () => {
    if (currentModuleIndex > 0) {
        currentModuleIndex--;
        loadModule(currentModuleIndex);
    }
});

moduleContentArea.addEventListener('click', (e) => {
    const selectedQuizOption = e.target.closest('.quiz-option');
    if (selectedQuizOption) {
        const container = e.target.closest('#quiz-options-container');
        const moduleIndex = parseInt(container.dataset.moduleIndex);
        const selectedIndex = parseInt(selectedQuizOption.dataset.optionIndex);
        userAnswers[moduleIndex] = selectedIndex;
        container.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
        selectedQuizOption.classList.add('selected');
    }

    const selectedShapeOption = e.target.closest('.shape-option');
    if (selectedShapeOption) {
        const container = e.target.closest('#shape-options-container');
        const moduleIndex = parseInt(container.dataset.moduleIndex);
        const selectedIndex = parseInt(selectedShapeOption.dataset.optionIndex);
        userAnswers[moduleIndex] = selectedIndex;
        container.querySelectorAll('.shape-option').forEach(opt => opt.classList.remove('selected'));
        selectedShapeOption.classList.add('selected');
    }

    if (e.target.classList.contains('gemini-eval-button')) {
        handleIdeaEvaluation(e);
    }
});

btnMainMenu.addEventListener('click', () => showScreen('welcome-screen'));
btnRestart.addEventListener('click', () => {
    userNameInput.value = '';
    nameError.classList.add('hidden');
    userNameInput.classList.remove('border-red-500');
    showScreen('welcome-screen');
});

// Modal Logic
function openModal(initialTab) {
    modalTabButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === initialTab);
    });
    modalTabContents.forEach(content => {
        content.classList.toggle('active', content.id === `${initialTab}-content`);
    });
    infoModal.classList.add('active');
}

infoModalBtns.forEach(button => {
    button.addEventListener('click', () => {
        openModal(button.dataset.tab);
    });
});

closeModalBtn.addEventListener('click', () => {
    infoModal.classList.remove('active');
});

infoModal.addEventListener('click', (e) => {
    if (e.target === infoModal) {
        infoModal.classList.remove('active');
    }
});

modalTabButtons.forEach(button => {
    button.addEventListener('click', () => {
        const targetTab = button.dataset.tab;
        modalTabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        modalTabContents.forEach(content => {
            content.classList.toggle('active', content.id === `${targetTab}-content`);
        });
    });
});

// Voice Assistant Logic
voiceAssistantBtn.addEventListener('click', () => {
    if (recognition) {
        try {
            if(window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            recognition.start();
        } catch(e) {
            console.error("Recognition already started.", e);
        }
    } else {
        alert("Üzgünüz, tarayıcınız ses tanımayı desteklemiyor.");
    }
});

</script>
</body>
</html>
