<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Yaratıcı Zeka Profili</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=Orbitron:wght@400;500;700&display=swap');
        
        :root {
            --neon-cyan: #00f6ff;
            --neon-purple: #a855f7;
            --neon-pink: #f472b6;
            --dark-bg: #0a0f1f;
            --dark-card: #111827;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(0, 246, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(168, 85, 247, 0.1) 0%, transparent 40%);
            min-height: 100vh;
            overflow-x: hidden;
            color: #e2e8f0;
        }
        
        .tech-font { font-family: 'Orbitron', sans-serif; }
        
        .card {
            perspective: 1500px;
            min-height: 520px;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .card.flipped .card-inner { transform: rotateY(180deg); }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            box-shadow: 0 0 20px rgba(0, 246, 255, 0.2), 0 0 40px rgba(168, 85, 247, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 2px solid;
            background: linear-gradient(145deg, #1a243a, var(--dark-card));
        }
        
        .card-front { border-image: linear-gradient(45deg, var(--neon-cyan), var(--neon-purple)) 1; }
        .card-back { border-image: linear-gradient(45deg, var(--neon-purple), var(--neon-pink)) 1; transform: rotateY(180deg); }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(0, 246, 255, 0.15);
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
            transition: width 0.5s ease;
            border-radius: 4px;
            box-shadow: 0 0 8px var(--neon-cyan);
        }
        
        .btn-nav {
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .btn-nav:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 0 20px var(--neon-cyan);
            border-color: var(--neon-cyan);
        }
        
        .btn-nav:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(80%); }
        
        .stars {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }
        
        @keyframes twinkle {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 0.8; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.5); }
        }
        
        .glow { animation: glow 3s infinite alternate; }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(0, 246, 255, 0.4), 0 0 30px rgba(168, 85, 247, 0.3); }
            to { box-shadow: 0 0 35px rgba(0, 246, 255, 0.6), 0 0 50px rgba(168, 85, 247, 0.5); }
        }
        
        .floating { animation: floating 5s infinite ease-in-out; }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        
        .task-input {
            background-color: #1e293b;
            color: #94a3b8;
            border: 1px solid #334155;
            border-radius: 0.5rem;
            padding: 0.75rem;
            width: 100%;
            transition: all 0.3s ease;
        }
        .task-input:focus {
            outline: none;
            border-color: var(--neon-cyan);
            background-color: #0f172a;
            box-shadow: 0 0 15px rgba(0, 246, 255, 0.4);
        }
        .task-textarea { resize: vertical; min-height: 100px; }

        .quiz-option, .rating-option {
            background-color: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .quiz-option:hover, .rating-option:hover {
            background-color: rgba(56, 189, 248, 0.2);
            border-color: var(--neon-cyan);
        }
        .quiz-option.selected, .rating-option.selected {
            background-color: rgba(0, 246, 255, 0.3);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 246, 255, 0.4);
        }
        
        .shape-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .shape-option:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--neon-cyan));
        }
        .shape-option.selected {
             transform: scale(1.1);
             filter: drop-shadow(0 0 15px var(--neon-cyan));
        }

        .loader {
            border: 4px solid #334155;
            border-top: 4px solid var(--neon-cyan);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal Styling */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(10, 15, 31, 0.8);
            backdrop-filter: blur(8px);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--dark-bg);
            border: 1px solid var(--neon-cyan);
            box-shadow: 0 0 40px rgba(0, 246, 255, 0.3);
            border-radius: 1.5rem;
            padding: 2rem;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        /* Tab Styling */
        .tab-button {
            background-color: #1e293b;
            color: #94a3b8;
            border: 1px solid #334155;
            transition: all 0.3s ease;
        }
        .tab-button.active, .tab-button:hover {
            background-color: var(--dark-card);
            color: var(--neon-cyan);
            border-color: var(--neon-cyan);
            box-shadow: 0 0 10px rgba(0, 246, 255, 0.3);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Archetype Card Styling */
        .archetype-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid #334155;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease-in-out;
            backdrop-filter: blur(3px);
        }
        .archetype-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 0 25px rgba(0, 246, 255, 0.3), 0 0 10px rgba(168, 85, 247, 0.2);
            border-color: var(--neon-cyan);
            background: rgba(30, 41, 59, 0.8);
        }
        .archetype-icon-container {
            margin: 0 auto 1rem auto;
            height: 80px;
            width: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--neon-cyan);
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 246, 255, 0.1) 0%, transparent 70%);
        }
        .archetype-icon-container svg {
            width: 50px;
            height: 50px;
            transition: all 0.3s ease;
        }
        .archetype-card:hover .archetype-icon-container svg {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px var(--neon-cyan));
        }

        /* Voice Assistant Button */
        #voice-assistant-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 40;
            background-color: var(--neon-purple);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px var(--neon-purple);
            transition: all 0.3s ease;
        }
        #voice-assistant-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px var(--neon-purple);
        }
        #voice-assistant-btn.listening {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(168, 85, 247, 0); }
            100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }

        /* Analysis Loader Animation */
        @keyframes pulse-loader {
            0%, 100% { transform: scale(0.6); opacity: 0; }
            50% { transform: scale(1); opacity: 1; }
        }
        .animate-pulse-loader-1 { animation: pulse-loader 3s ease-in-out infinite; }
        .animate-pulse-loader-2 { animation: pulse-loader 3s ease-in-out infinite; animation-delay: 1.5s; }
        .animate-spin-slow { animation: spin 4s linear infinite reverse; }

        /* Background Video */
        #bg-video {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: translate(-50%, -50%);
            z-index: 0;
            opacity: 0.2; /* Increased opacity */
        }
        .welcome-container {
            background-color: #0a0f1f; /* Fallback background */
        }
        
        /* Speech-to-text button */
        .speech-to-text-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: #94a3b8;
            transition: color 0.3s, transform 0.3s;
        }
        .speech-to-text-btn:hover {
            color: var(--neon-cyan);
        }
        .speech-to-text-btn.listening {
            color: var(--neon-pink);
            animation: pulse-mic 1.5s infinite;
        }
        @keyframes pulse-mic {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 flex flex-col min-h-screen">
    <div class="stars" id="stars"></div>

    <main class="flex-grow">
        <!-- EKRAN 1: GİRİŞ EKRANI -->
        <div id="welcome-screen" class="max-w-5xl mx-auto">
            <div class="welcome-container relative bg-slate-900/70 backdrop-blur-sm rounded-3xl p-4 md:p-8 shadow-2xl glow overflow-hidden">
                <video id="bg-video" autoplay loop muted playsinline>
                    <source src="https://assets.mixkit.co/videos/preview/mixkit-abstract-liquid-bubbles-in-a-loop-32163-large.mp4" type="video/mp4">
                </video>
                <div class="relative z-10 flex flex-col items-center justify-center py-8">
                    <div class="mb-6 relative">
                        <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-500 blur-2xl opacity-30 rounded-full"></div>
                        <h1 class="tech-font text-4xl sm:text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-300 via-white to-purple-400 relative z-10 text-center" data-lang-key="welcome_title">
                            YARATICI ZEKA PROFİLİ
                        </h1>
                    </div>
                    <div class="w-full max-w-md mx-auto mb-8 relative">
                        <div class="floating mb-8 w-40 h-40 md:w-48 md:h-48 mx-auto">
                            <div id="abstract-shape-container" class="w-full h-full"></div>
                        </div>
                        <p class="text-cyan-200 text-center mb-6 text-base md:text-lg" data-lang-key="welcome_intro">
                            Yaratıcı yaklaşımlarınızı keşfetmek ve potansiyelinizi ortaya çıkarmak için bu yolculuğa çıkın.
                        </p>
                        <div class="bg-slate-900/50 p-6 rounded-xl border border-cyan-700/30 shadow-lg">
                            <label for="user-name" class="block text-cyan-300 mb-2 tech-font" data-lang-key="enter_name">İSİM SOYİSİM:</label>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <div class="relative flex-grow">
                                    <input type="text" id="user-name" class="task-input w-full pr-10" placeholder="Unvan ve İsim">
                                    <button class="speech-to-text-btn absolute top-1/2 right-2 -translate-y-1/2" data-target="user-name" title="Sesle Yaz">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4zM4 4a4 4 0 014-4h4a4 4 0 014 4v6a4 4 0 01-4 4H8a4 4 0 01-4-4V4zM14 10a1 1 0 011 1v1a5 5 0 01-5 5H6a5 5 0 01-5-5v-1a1 1 0 112 0v1a3 3 0 003 3h4a3 3 0 003-3v-1a1 1 0 011-1z"/></svg>
                                    </button>
                                </div>
                                <button id="start-assessment" class="btn-nav vibrate-on-click bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-6 py-3 font-semibold tech-font flex items-center justify-center">
                                    <span data-lang-key="start_button">BAŞLA</span>
                                </button>
                            </div>
                            <p id="name-error" class="text-red-400 text-sm mt-2 text-center hidden">Lütfen başlamadan önce bir isim girin.</p>
                        </div>
                        <div class="mt-8 flex flex-wrap justify-center gap-3">
                            <button class="info-modal-btn btn-nav vibrate-on-click bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="about">Hakkında</button>
                            <button class="info-modal-btn btn-nav vibrate-on-click bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="archetypes">Arketipler</button>
                            <button class="info-modal-btn btn-nav vibrate-on-click bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="contact">İletişim</button>
                            <button class="info-modal-btn btn-nav vibrate-on-click bg-slate-800/50 text-cyan-300 border border-cyan-800/50 rounded-lg px-4 py-2 text-sm" data-tab="references">Kaynakça</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- EKRAN 2: DEĞERLENDİRME EKRANI -->
        <div id="assessment-screen" class="max-w-5xl mx-auto hidden">
            <div class="bg-slate-900/70 backdrop-blur-sm rounded-3xl p-4 md:p-8 shadow-2xl">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                     <div class="w-full md:w-1/3">
                        <button id="btn-main-menu" class="btn-nav vibrate-on-click bg-slate-900 text-cyan-400 border border-cyan-700/50 rounded-lg px-4 py-2 font-medium shadow-sm hover:bg-slate-800 tech-font" data-lang-key="main_menu_button">ANA MENÜ</button>
                    </div>
                    <div class="w-full md:w-1/3 text-center order-first md:order-none">
                        <h2 id="stage-title" class="tech-font text-xl text-cyan-300">Aşama 1: Keşif</h2>
                    </div>
                    <div class="w-full md:w-1/3 flex justify-center md:justify-end">
                        <span class="bg-gradient-to-r from-cyan-900/50 to-purple-900/50 text-white py-2 px-4 rounded-full text-sm font-bold tech-font">
                            <span data-lang-key="progress">İLERLEME</span>: <span id="overall-progress-count">1</span>/22
                        </span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="progress-bar"><div class="progress" id="progress-bar" style="width: 4.5%"></div></div>
                </div>
                
                <div class="grid grid-cols-1 gap-8">
                    <div class="card" id="current-card">
                        <div class="card-inner">
                            <div class="card-front p-4 md:p-6 flex flex-col h-full">
                                 <h3 class="text-2xl md:text-3xl font-bold mb-4 tech-font text-cyan-300" id="module-title">Modül Başlığı</h3>
                                 <div class="flex-grow overflow-auto pr-2 flex flex-col justify-center items-center" id="module-content-area">
                                    <!-- Modül içeriği buraya gelecek -->
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-between items-center mt-8 gap-4">
                    <button id="btn-prev" class="btn-nav vibrate-on-click w-full sm:w-auto bg-slate-900 text-cyan-400 border border-cyan-700/50 rounded-lg px-6 py-3 font-medium flex items-center justify-center">ÖNCEKİ</button>
                    <button id="btn-next" class="btn-nav vibrate-on-click w-full sm:w-auto bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-6 py-3 font-medium flex items-center justify-center">SONRAKİ</button>
                </div>
            </div>
        </div>

        <!-- EKRAN 3: SONUÇ EKRANI -->
        <div id="results-screen" class="max-w-5xl mx-auto hidden">
             <div class="bg-slate-900/70 backdrop-blur-sm rounded-3xl p-4 md:p-8 shadow-2xl">
                <h1 class="tech-font text-3xl md:text-4xl font-bold text-center mb-2 text-cyan-300" data-lang-key="results_title">Yaratıcı Profiliniz</h1>
                <p class="text-center text-cyan-200 mb-8" id="user-name-results"></p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="tech-font text-xl text-purple-300 mb-2 text-center">Arketip Dağılımı</h3>
                        <canvas id="archetype-chart"></canvas>
                    </div>
                     <div>
                        <h3 class="tech-font text-xl text-purple-300 mb-2 text-center">Yaratıcı Zeka Dengesi</h3>
                        <canvas id="skills-chart"></canvas>
                    </div>
                </div>
                
                <div class="mt-8 bg-slate-900/50 p-6 rounded-xl border border-cyan-700/30">
                    <h3 class="tech-font text-xl text-purple-300 mb-3" data-lang-key="profile_analysis">Profil Analizi</h3>
                    <div id="profile-analysis-text" class="text-slate-300 leading-relaxed"></div>
                </div>

                <div class="text-center mt-8">
                     <button id="btn-restart" class="btn-nav vibrate-on-click bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-lg px-8 py-3 font-semibold tech-font" data-lang-key="restart_button">Yeniden Başla</button>
                </div>
             </div>
        </div>
    </main>

    <footer class="text-center text-slate-500 text-xs p-4 mt-auto">
        © 2025 Tüm Hakları Saklıdır. Bu içerik eğitim amaçlıdır.
    </footer>

    <!-- BİLGİ MODALI -->
    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal-btn" class="absolute top-4 right-5 text-slate-400 hover:text-white transition-colors vibrate-on-click">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="flex flex-wrap justify-center border-b border-slate-700 mb-6">
                <button class="tab-button vibrate-on-click tech-font py-2 px-6 rounded-t-lg" data-tab="about">Hakkında</button>
                <button class="tab-button vibrate-on-click tech-font py-2 px-6 rounded-t-lg" data-tab="archetypes">Arketipler</button>
                <button class="tab-button vibrate-on-click tech-font py-2 px-6 rounded-t-lg" data-tab="contact">İletişim</button>
                <button class="tab-button vibrate-on-click tech-font py-2 px-6 rounded-t-lg" data-tab="references">Kaynakça</button>
            </div>
            <div id="tab-content-container">
                <div id="archetypes-content" class="tab-content">
                    <div class="relative">
                        <div id="archetype-carousel-wrapper" class="overflow-hidden">
                            <div id="archetype-carousel" class="flex transition-transform duration-500 ease-in-out">
                                <!-- Archetype Cards will be dynamically inserted here -->
                            </div>
                        </div>
                        <button id="archetype-prev" class="absolute top-1/2 -left-4 -translate-y-1/2 bg-slate-800/50 p-2 rounded-full hover:bg-slate-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed z-10 vibrate-on-click">
                            <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <button id="archetype-next" class="absolute top-1/2 -right-4 -translate-y-1/2 bg-slate-800/50 p-2 rounded-full hover:bg-slate-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed z-10 vibrate-on-click">
                            <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
                <div id="about-content" class="tab-content">
                    <h3 class="tech-font text-2xl text-purple-300 mb-4">Testin Amacı Nedir?</h3>
                    <p class="text-slate-300 leading-relaxed mb-4">Bu profil testi, yaratıcılığınızın hangi yönlerinin daha baskın olduğunu keşfetmenize yardımcı olmak için tasarlanmıştır. Sonuçlar, klinik bir psikolojik değerlendirme değildir; bunun yerine, yaratıcı düşünce süreçlerinizi ve problem çözme yaklaşımlarınızı anlamanız için bir çerçeve sunar.</p>
                    <p class="text-slate-300 leading-relaxed">Mitolojik arketipleri, farklı yaratıcılık türleri için güçlü birer metafor olarak kullanıyoruz. Bu testle amacımız, kendi yaratıcı "süper güçlerinizi" tanımanıza, bu güçleri nasıl daha etkili kullanabileceğinize ve potansiyel gelişim alanlarınıza dair farkındalık kazanmanıza olanak tanımaktır. Bu yolculuk, yaratıcı potansiyelinizi en üst düzeye çıkarmanız için bir başlangıç noktasıdır.</p>
                </div>
                <div id="contact-content" class="tab-content">
                    <p class="text-slate-300 leading-relaxed mb-2">Sorularınız veya geri bildirimleriniz için LinkedIn üzerinden iletişime geçebilirsiniz:</p>
                    <a href="https://linkedin.com/in/semayy" target="_blank" rel="noopener noreferrer" class="text-cyan-400 hover:text-cyan-300 tech-font transition-colors">
                        linkedin.com/in/semayy
                    </a>
                    <p class="text-slate-300 mt-4">Semanur Ayyıldız<br><span class="text-sm text-slate-400">Görsel İletişim Tasarımı ve Dijital Dönüşüm Uzmanı</span></p>
                </div>
                <div id="references-content" class="tab-content">
                    <h3 class="tech-font text-2xl text-purple-300 mb-4">Kaynakça</h3>
                    <ul class="list-disc list-inside text-slate-300 space-y-2 text-sm">
                        <li>Guilford, J. P. (1967). The Nature of Human Intelligence. McGraw-Hill.</li>
                        <li>Runco, M. A., & Jaeger, G. J. (2012). The Standard Definition of Creativity. Creativity Research Journal, 24(1), 92–96.</li>
                        <li>Sternberg, R. J. (Ed.). (1999). Handbook of Creativity. Cambridge University Press.</li>
                        <li>Torrance, E. P. (1974). Torrance Tests of Creative Thinking. Scholastic Testing Service.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- SESLİ ASİSTAN BUTONU -->
    <button id="voice-assistant-btn" title="Sesli Asistanı Başlat" class="vibrate-on-click">
        <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 7h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h6a2 2 0 012 2v10a2 2 0 01-2 2z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3V1M15 3V1M9 21v-2M15 21v-2" />
        </svg>
    </button>

<script>
// --- GLOBAL DEĞİŞKENLER VE DOM ELEMENTLERİ --- //
// Ekranlar
const welcomeScreen = document.getElementById('welcome-screen');
const assessmentScreen = document.getElementById('assessment-screen');
const resultsScreen = document.getElementById('results-screen');

// Butonlar ve Girdiler
const startAssessmentBtn = document.getElementById('start-assessment');
const userNameInput = document.getElementById('user-name');
const nameError = document.getElementById('name-error');
const btnPrev = document.getElementById('btn-prev');
const btnNext = document.getElementById('btn-next');
const btnMainMenu = document.getElementById('btn-main-menu');
const btnRestart = document.getElementById('btn-restart');

// Değerlendirme Ekranı Elementleri
const stageTitle = document.getElementById('stage-title');
const overallProgressCount = document.getElementById('overall-progress-count');
const progressBar = document.getElementById('progress-bar');
const moduleTitle = document.getElementById('module-title');
const moduleContentArea = document.getElementById('module-content-area');

// Sonuç Ekranı Elementleri
const userNameResults = document.getElementById('user-name-results');
const archetypeChartCanvas = document.getElementById('archetype-chart');
const skillsChartCanvas = document.getElementById('skills-chart');
const profileAnalysisText = document.getElementById('profile-analysis-text');
const starsContainer = document.getElementById('stars');

// Modal, Tab & Carousel Elementleri
const infoModal = document.getElementById('info-modal');
const closeModalBtn = document.getElementById('close-modal-btn');
const infoModalBtns = document.querySelectorAll('.info-modal-btn');
const modalTabButtons = infoModal.querySelectorAll('.tab-button');
const modalTabContents = infoModal.querySelectorAll('.tab-content');
const archetypeCarousel = document.getElementById('archetype-carousel');
const archetypePrevBtn = document.getElementById('archetype-prev');
const archetypeNextBtn = document.getElementById('archetype-next');

// Sesli Asistan Elementleri
const voiceAssistantBtn = document.getElementById('voice-assistant-btn');

// Durum (State) Değişkenleri
let currentModuleIndex = 0;
let userAnswers = {};
let userArchetypeScores = {};
let creativitySkillsScores = {};
let archetypeChart = null;
let skillsChart = null;
let archetypeCurrentIndex = 0;
let activeSpeechToTextInput = null;

// --- DİL VE VERİ YAPILARI --- //
const translations = {
    tr: {
        welcome_title: "YARATICI ZEKA PROFİLİ",
        welcome_intro: "Yaratıcı yaklaşımlarınızı keşfetmek ve potansiyelinizi ortaya çıkarmak için bu yolculuğa çıkın.",
        enter_name: "İSİM SOYİSİM:",
        start_button: "BAŞLA",
        main_menu_button: "ANA MENÜ",
        progress: "İLERLEME",
        results_title: "Yaratıcı Profiliniz",
        profile_analysis: "Profil Analizi",
        restart_button: "Yeniden Başla",
    }
};

const archetypes = {
    athena: { 
        tr: { name: "Stratejist", desc: "Stratejik ve mantıksal yaratıcılık. Problemleri analiz eder, planlar ve net çözümler üretir." },
        icon: `<path d="M50 15 C 30 15, 20 30, 20 50 C 20 70, 30 85, 50 85 C 70 85, 80 70, 80 50 C 80 30, 70 15, 50 15 Z M 50 25 V 75 M 35 40 H 65 M 35 60 H 65" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
    apollo: { 
        tr: { name: "Sanatçı", desc: "Uyum ve estetik yaratıcılık. Güzellik, denge ve düzen arar. Sanatsal ve tasarımsal yetenekleri temsil eder." },
        icon: `<circle cx="50" cy="50" r="15" stroke-width="5"/><path d="M50 25 V 15 M50 75 V 85 M75 50 H 85 M25 50 H 15 M35 35 L 28 28 M65 65 L 72 72 M35 65 L 28 72 M65 35 L 72 28" stroke-width="5" stroke-linecap="round"/>`
    },
    hermes: { 
        tr: { name: "Bağlantı Kurucu", desc: "Çevik ve birleştirici yaratıcılık. Fikirler arasında hızla bağlantı kurar, iletişimde ustadır ve yenilikleri yayar." },
        icon: `<circle cx="25" cy="25" r="8"/><circle cx="75" cy="25" r="8"/><circle cx="25" cy="75" r="8"/><circle cx="75" cy="75" r="8"/><circle cx="50" cy="50" r="8"/><path d="M30 29 L 45 45 M 70 29 L 55 45 M 30 71 L 45 55 M 70 71 L 55 55" stroke-width="4"/>`
    },
    hephaestus: { 
        tr: { name: "Usta", desc: "İnşa eden ve üreten yaratıcılık. Soyut fikirleri somut projelere dönüştürür, zanaatkarlık ve mühendislik becerileri yüksektir." },
        icon: `<path d="M20 70 L 40 70 L 40 50 L 50 40 L 60 50 L 60 70 L 80 70 M 30 20 L 70 20 L 75 30 L 25 30 Z" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
    prometheus: { 
        tr: { name: "Yenilikçi", desc: "Vizyoner ve kural yıkan yaratıcılık. Geleceği şekillendirir, radikal yenilikler peşindedir ve mevcut durumu sorgular." },
        icon: `<path d="M50 10 L 40 40 L 60 40 L 50 70 M 50 70 L 45 90 M 50 70 L 55 90" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
    dionysus: { 
        tr: { name: "Kaşif", desc: "Sezgisel ve spontane yaratıcılık. Kuralların dışında düşünür, kaostan beslenir ve beklenmedik fikirler ortaya atar." },
        icon: `<path d="M50 90 C 70 70, 30 70, 50 50 C 60 35, 40 35, 50 20 C 55 10, 45 10, 50 10" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
    janus: { 
        tr: { name: "Bilge", desc: "Yansıtıcı ve çift yönlü yaratıcılık. Geçmişten ders alıp geleceğe uygular, zıtlıklar arasında denge kurar." },
        icon: `<path d="M50 15 V 85 M 50 50 C 30 40 30 60 50 50 M 50 50 C 70 40 70 60 50 50" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
    persephone: { 
        tr: { name: "Dönüştürücü", desc: "Dönüştürücü yaratıcılık. Mevcut olanı alır ve ona yepyeni bir anlam veya işlev kazandırır." },
        icon: `<path d="M30 80 H 70 M 50 80 V 40 C 50 20 70 20 70 40 M 50 40 C 50 20 30 20 30 40" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
    thalia: { 
        tr: { name: "Sosyal Zeka", desc: "Sosyal ve esprili yaratıcılık. İnsanları bir araya getirir, mizahtan ve oyundan beslenir, sosyal zekası yüksektir." },
        icon: `<circle cx="50" cy="50" r="30" stroke-width="5"/><circle cx="40" cy="40" r="3"/><circle cx="60" cy="40" r="3"/><path d="M40 60 Q 50 70 60 60" stroke-width="5" stroke-linecap="round"/>`
    },
    artemis: { 
        tr: { name: "Odak", desc: "Odaklanmış ve hedefe yönelik yaratıcılık. Belirli bir hedefe kilitlenir ve o hedefe ulaşmak için hassas ve etkili çözümler geliştirir." },
        icon: `<circle cx="50" cy="50" r="30" stroke-width="5"/><circle cx="50" cy="50" r="15" stroke-width="5"/><path d="M10 50 H 70 M 60 40 L 70 50 L 60 60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>`
    },
};

const creativitySkills = {
    divergent: { tr: "Iraksak Düşünme" },
    convergent: { tr: "Yakınsak Düşünme" },
    lateral: { tr: "Yanal Düşünme" },
    constructive: { tr: "İnşacı Düşünme" },
};

const assessmentModules = [
    // --- AŞAMA 1: KEŞİF (Iraksak & Yanal Düşünme) ---
    { stage: 1, type: 'task', archetypes: ['persephone', 'dionysus'], tr: { title: "Modül 1: Alternatif Kullanımlar", instruction: "Sıradan bir 'tuğla' için olabildiğince çok sayıda, alışılmadık ve yaratıcı kullanım alanı listeleyin." } },
    { stage: 1, type: 'task', archetypes: ['prometheus', 'hermes'], tr: { title: "Modül 2: Sonuçları Hayal Etme", instruction: "İnsanların uykuya ihtiyacı olmasaydı, dünya nasıl bir yer olurdu? Bu durumun 3 olumlu ve 3 olumsuz sonucunu yazın." } },
    { stage: 1, type: 'task', archetypes: ['hermes', 'thalia'], tr: { title: "Modül 3: Bağlantı Kurma", instruction: "'Pusula', 'fısıltı' ve 'gölge' kelimelerini anlamlı bir şekilde bir araya getiren bir cümle veya kısa bir paragraf yazın." } },
    { stage: 1, type: 'task', archetypes: ['janus', 'athena'], tr: { title: "Modül 4: Problemi Yeniden Çerçeveleme", instruction: "Bir müzedeki en sıkıcı olduğu düşünülen bir eseri, ziyaretçiler için en ilgi çekici hale nasıl getirirsiniz? 3 somut öneri sunun." } },
    { stage: 1, type: 'task', archetypes: ['hephaestus', 'artemis'], tr: { title: "Modül 5: Kısıtlamalarla Tasarım", instruction: "Sadece tek bir A4 kağıdı ve bir ataş kullanarak, bir yumurtayı 1 metreden düşmeye karşı koruyacak bir yapı tasarlayın. Adımlarınızı açıklayın." } },
    { stage: 1, type: 'intro', tr: { title: "Modül 6: Aşama 1 Tamamlandı", instruction: "Fikir üretme ve keşif aşamasını tamamladınız. Şimdi analitik ve mantıksal düşünme becerilerinizi test etme zamanı." } },
    
    // --- AŞAMA 2: SINAMA (Yakınsak & Mantıksal Düşünme) ---
    { stage: 2, type: 'quiz', tr: { question: "Bir gölde nilüfer yaprakları var. Her gün, yaprakların kapladığı alan iki katına çıkıyor. Gölün tamamen kaplanması 48 gün sürüyorsa, yarısının kaplanması kaç gün sürer?", options: ["24 gün", "47 gün", "12 gün"], answer: 1, archetype: "athena" } },
    { stage: 2, type: 'quiz', tr: { question: "Aşağıdaki kelimelerden hangisi diğerlerinden farklıdır?", options: ["Gitar", "Piyano", "Keman", "Bateri", "Flüt"], answer: 3, archetype: "apollo" } },
    { stage: 2, type: 'quiz', tr: { question: "Bir doktor size 3 hap verir ve bunları yarım saat arayla almanızı söyler. Tüm hapları bitirmeniz ne kadar sürer?", options: ["1.5 saat", "1 saat", "45 dakika"], answer: 1, archetype: "hermes" } },
    { stage: 2, type: 'quiz', tr: { question: "Aşağıdaki beş şekilden dördü belirli bir şekilde benzerdir. Hangisi diğerlerinden farklıdır?", options: ["Kare", "Daire", "Üçgen", "Elips", "Altıgen"], answer: 1, archetype: "apollo" } },
    { stage: 2, type: 'quiz', tr: { question: "Bir adam, bir binanın 10. katında yaşıyor. Her gün asansörle aşağı iniyor. Yukarı çıkarken ise, eğer hava yağmurlu değilse 7. kata kadar asansörle çıkıp kalanını merdivenle yürüyor. Neden?", options: ["Asansör bozuk.", "Spor yapmak istiyor.", "Adamın boyu kısa ve sadece 7. kat düğmesine yetişebiliyor (yağmurlu günlerde şemsiyesiyle daha yukarı basabiliyor)."], answer: 2, archetype: "prometheus" } },
    { stage: 2, type: 'intro', tr: { title: "Modül 12: Aşama 2 Tamamlandı", instruction: "Analitik düşünme aşamasını başarıyla geçtiniz. Sonraki aşama, görsel zekanızı ve desen tanıma yeteneğinizi ölçecektir." } },

    // --- AŞAMA 3: SENTEZ (Görsel Zeka) ---
    { stage: 3, type: 'shape', archetype: 'apollo', tr: { title: "Modül 13: Deseni Tamamla" }, data: { problem: `<g><circle cx="20" cy="20" r="10"/><circle cx="50" cy="20" r="10"/><circle cx="80" cy="20" r="10"/><circle cx="20" cy="50" r="10"/><circle cx="50" cy="50" r="10"/></g>`, options: [`<circle cx="80" cy="50" r="10"/>`, `<circle cx="20" cy="80" r="10"/>`], answer: 0 } },
    { stage: 3, type: 'shape', archetype: 'hephaestus', tr: { title: "Modül 14: Eksik Parça" }, data: { problem: `<path d="M20 20 H 80 V 80 H 20 V 20 M 50 20 V 80 M 20 50 H 80" stroke-width="3"/>`, options: [`<circle cx="50" cy="50" r="10" stroke-width="3"/>`, `<path d="M35 35 L 65 65 M 65 35 L 35 65" stroke-width="3"/>`], answer: 1 } },
    { stage: 3, type: 'shape', archetype: 'dionysus', tr: { title: "Modül 15: Farklı Olanı Bul" }, data: { problem: `<g><path d="M20 80 L 50 20 L 80 80 Z"/><rect x="110" y="20" width="60" height="60"/><circle cx="210" cy="50" r="30"/></g>`, options: [`<path d="M20 80 L 50 20 L 80 80 Z"/>`, `<rect x="110" y="20" width="60" height="60"/>`, `<path d="M290 20 H 350 V 80"/>`], answer: 2 } },
    { stage: 3, type: 'shape', archetype: 'janus', tr: { title: "Modül 16: Simetriyi Oluştur" }, data: { problem: `<path d="M50 20 V 80 M 50 50 C 80 20 80 80 50 50" stroke-width="3"/>`, options: [`<path d="M50 50 C 20 20 20 80 50 50" stroke-width="3"/>`, `<path d="M20 20 H 80" stroke-width="3"/>`], answer: 0 } },
    { stage: 3, type: 'shape', archetype: 'artemis', tr: { title: "Modül 17: Katlama Sonucu" }, data: { problem: `<g><rect x="10" y="10" width="80" height="80" stroke-dasharray="5 5"/><path d="M10 50 H 90" stroke-width="2"/><path d="M50 10 V 50" stroke-width="2"/><circle cx="30" cy="30" r="5" fill="currentColor"/></g>`, options: [`<circle cx="70" cy="70" r="5"/>`, `<g><circle cx="30" cy="70" r="5"/><circle cx="70" cy="70" r="5"/></g>`], answer: 1 } },
    { stage: 3, type: 'intro', tr: { title: "Modül 18: Aşama 3 Tamamlandı", instruction: "Görsel zeka bölümünü tamamladınız. Son aşamada, kendi yaratıcı becerilerinizi değerlendireceksiniz." } },
    
    // --- AŞAMA 4: ÖZ-DEĞERLENDİRME (Yaratıcılık Becerileri) ---
    { stage: 4, type: 'rating', skill: 'divergent', tr: { title: "Modül 19: Iraksak Düşünme", question: "Bir konu hakkında çok sayıda farklı fikir üretme konusunda kendinize 1'den 5'e kadar puan verin." } },
    { stage: 4, type: 'rating', skill: 'convergent', tr: { title: "Modül 20: Yakınsak Düşünme", question: "Farklı seçenekler arasından en mantıklı ve etkili olanı seçme konusunda kendinize 1'den 5'e kadar puan verin." } },
    { stage: 4, type: 'rating', skill: 'lateral', tr: { title: "Modül 21: Yanal Düşünme", question: "Problemlere alışılmışın dışında, beklenmedik açılardan bakabilme konusunda kendinize 1'den 5'e kadar puan verin." } },
    { stage: 4, type: 'rating', skill: 'constructive', tr: { title: "Modül 22: İnşacı Düşünme", question: "Bir fikri alıp onu somut bir plana veya projeye dönüştürme konusunda kendinize 1'den 5'e kadar puan verin." } }
];

// --- GEMINI API YARDIMCI FONKSİYONU --- //
async function callGeminiAPI(prompt) {
    const apiKey = "AIzaSyCEEywiObjmjA1ecwseMortdDKnt5Bwjrc"; 
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
    
    const payload = {
        contents: [{ role: "user", parts: [{ text: prompt }] }]
    };

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error(`API call failed with status: ${response.status}`);
        }

        const result = await response.json();
        
        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
            return result.candidates[0].content.parts[0].text;
        } else {
            // Handle cases where the response structure is unexpected or content is missing
            if (result.promptFeedback && result.promptFeedback.blockReason) {
                throw new Error(`API call blocked: ${result.promptFeedback.blockReason}`);
            }
            throw new Error("Invalid response structure from API.");
        }
    } catch (error) {
        console.error("Error calling Gemini API:", error);
        throw error;
    }
}


// --- UYGULAMA MANTIĞI --- //

/** Uygulamayı başlatır veya sıfırlar */
function initializeApp() {
    currentModuleIndex = 0;
    userAnswers = {};
    userArchetypeScores = Object.keys(archetypes).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});
    creativitySkillsScores = Object.keys(creativitySkills).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});
    
    showScreen('assessment-screen');
    loadModule(currentModuleIndex);
}

/** Belirtilen indeksteki modülü yükler */
function loadModule(index) {
    const module = assessmentModules[index];
    
    stageTitle.textContent = `Aşama ${module.stage}: ${getStageName(module.stage)}`;
    overallProgressCount.textContent = `${index + 1}/${assessmentModules.length}`;
    progressBar.style.width = `${((index + 1) / assessmentModules.length) * 100}%`;
    moduleTitle.textContent = module.tr.title;
    moduleContentArea.innerHTML = '';

    switch(module.type) {
        case 'intro': createIntroModule(module); break;
        case 'task': createTaskModule(module, index); break;
        case 'quiz': createQuizModule(module, index); break;
        case 'shape': createShapeModule(module, index); break;
        case 'rating': createRatingModule(module, index); break;
    }
    updateNavButtons();
}

/** Tanıtım modülü arayüzünü oluşturur */
function createIntroModule(module) {
    moduleContentArea.innerHTML = `<p class="text-center text-lg text-slate-300 max-w-lg">${module.tr.instruction}</p>`;
}

/** Görev modülü arayüzünü (Gemini butonu ile) oluşturur */
function createTaskModule(module, index) {
    const savedAnswer = userAnswers[index] || "";
    moduleContentArea.innerHTML = `
        <div class="w-full max-w-xl text-center">
            <p class="text-slate-300 mb-4">${module.tr.instruction}</p>
            <div class="relative">
                <textarea class="task-input task-textarea w-full pr-10" data-module-index="${index}">${savedAnswer}</textarea>
                <button class="speech-to-text-btn absolute top-3 right-2" data-target="textarea[data-module-index='${index}']" title="Sesle Yaz">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4zM4 4a4 4 0 014-4h4a4 4 0 014 4v6a4 4 0 01-4 4H8a4 4 0 01-4-4V4zM14 10a1 1 0 011 1v1a5 5 0 01-5 5H6a5 5 0 01-5-5v-1a1 1 0 112 0v1a3 3 0 003 3h4a3 3 0 003-3v-1a1 1 0 011-1z"/></svg>
                </button>
            </div>
        </div>
    `;
}

/** Quiz modülü arayüzünü oluşturur */
function createQuizModule(module, index) {
    const savedAnswer = userAnswers[index];
    let optionsHTML = module.tr.options.map((option, i) => `
        <div class="quiz-option vibrate-on-click w-full text-left p-4 rounded-lg ${savedAnswer === i ? 'selected' : ''}" data-option-index="${i}">
            <span class="font-bold tech-font mr-2">${String.fromCharCode(65 + i)}:</span>
            <span>${option}</span>
        </div>
    `).join('');

    moduleContentArea.innerHTML = `
        <div class="w-full max-w-2xl text-center">
            <p class="text-slate-300 mb-6 text-lg">${module.tr.question}</p>
            <div class="flex flex-col gap-4" id="quiz-options-container" data-module-index="${index}">${optionsHTML}</div>
        </div>
    `;
}

/** Şekil eşleştirme modülü arayüzünü oluşturur */
function createShapeModule(module, index) {
    const savedAnswer = userAnswers[index];
    const optionsHTML = module.data.options.map((option, i) => `
        <div class="shape-option vibrate-on-click p-4 ${savedAnswer === i ? 'selected' : ''}" data-option-index="${i}">
            <svg viewBox="0 0 100 100" class="w-24 h-24" fill="none" stroke="white" stroke-width="3">${option}</svg>
        </div>
    `).join('');

    moduleContentArea.innerHTML = `
         <div class="w-full max-w-2xl text-center">
            <p class="text-slate-300 mb-4 text-lg">Problemi en iyi çözen veya tamamlayan şekli seçin.</p>
            <div class="mb-8 p-4"><svg viewBox="0 0 100 100" class="w-32 h-32 mx-auto" fill="none" stroke="var(--neon-cyan)" stroke-width="3">${module.data.problem}</svg></div>
            <div class="flex flex-wrap justify-center gap-4 sm:gap-8" id="shape-options-container" data-module-index="${index}">${optionsHTML}</div>
        </div>
    `;
}

/** Derecelendirme modülü arayüzünü oluşturur */
function createRatingModule(module, index) {
    const savedAnswer = userAnswers[index];
    let optionsHTML = [1, 2, 3, 4, 5].map(val => `
        <div class="rating-option vibrate-on-click w-16 h-16 sm:flex-1 flex items-center justify-center text-center p-4 rounded-lg ${savedAnswer === val ? 'selected' : ''}" data-option-value="${val}">
            <span class="font-bold tech-font text-2xl">${val}</span>
        </div>
    `).join('');

    moduleContentArea.innerHTML = `
        <div class="w-full max-w-2xl text-center">
            <p class="text-slate-300 mb-6 text-lg">${module.tr.question}</p>
            <div class="flex flex-wrap justify-center gap-2 sm:gap-4" id="rating-options-container" data-module-index="${index}">${optionsHTML}</div>
        </div>
    `;
}

/** Navigasyon butonlarının durumunu günceller */
function updateNavButtons() {
    btnPrev.disabled = currentModuleIndex === 0;
    btnNext.textContent = currentModuleIndex === assessmentModules.length - 1 ? 'SONUÇLARI GÖR' : 'SONRAKİ';
}

/** Sonuçları hesaplar ve gösterir */
async function showResults() {
    showScreen('results-screen');

    userArchetypeScores = Object.keys(archetypes).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});
    creativitySkillsScores = Object.keys(creativitySkills).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});

    assessmentModules.forEach((module, index) => {
        const answer = userAnswers[index];
        if (module.type === 'task' && answer && answer.trim() !== "") {
            module.archetypes.forEach(arc => userArchetypeScores[arc]++);
        }
        if (module.type === 'quiz' && answer === module.answer) {
            userArchetypeScores[module.archetype]++;
        }
        if (module.type === 'shape' && answer === module.data.answer) {
            userArchetypeScores[module.archetype]++;
        }
        if (module.type === 'rating' && answer) {
            creativitySkillsScores[module.skill] = answer;
        }
    });
    
    userNameResults.textContent = userNameInput.value.trim();
    
    createRadarChart();
    createSkillsChart();
    await generateProfileAnalysis();
}

/** Radar grafiğini oluşturur */
function createRadarChart() {
    if (archetypeChart) archetypeChart.destroy();
    const labels = Object.values(archetypes).map(a => a.tr.name);
    const data = Object.values(userArchetypeScores);

    archetypeChart = new Chart(archetypeChartCanvas, {
        type: 'radar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Arketip Dağılımı',
                data: data,
                backgroundColor: 'rgba(0, 246, 255, 0.2)',
                borderColor: 'rgba(0, 246, 255, 1)',
                pointBackgroundColor: 'rgba(0, 246, 255, 1)',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                r: {
                    angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                    grid: { color: 'rgba(255, 255, 255, 0.2)' },
                    pointLabels: { color: '#e2e8f0', font: { size: 12 } },
                    ticks: { display: false, stepSize: 1 }
                }
            },
            plugins: { legend: { display: false } }
        }
    });
}

/** Beceri grafiğini oluşturur */
function createSkillsChart() {
    if (skillsChart) skillsChart.destroy();
    const labels = Object.values(creativitySkills).map(s => s.tr);
    const data = Object.values(creativitySkillsScores);

    skillsChart = new Chart(skillsChartCanvas, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Yaratıcılık Becerileri',
                data: data,
                backgroundColor: [
                    'rgba(0, 246, 255, 0.4)',
                    'rgba(168, 85, 247, 0.4)',
                    'rgba(244, 114, 182, 0.4)',
                    'rgba(56, 189, 248, 0.4)'
                ],
                borderColor: [
                    'rgba(0, 246, 255, 1)',
                    'rgba(168, 85, 247, 1)',
                    'rgba(244, 114, 182, 1)',
                    'rgba(56, 189, 248, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                x: {
                    beginAtZero: true,
                    max: 5,
                    grid: { color: 'rgba(255, 255, 255, 0.2)' },
                    ticks: { color: '#e2e8f0' }
                },
                y: {
                    grid: { display: false },
                    ticks: { color: '#e2e8f0' }
                }
            },
            plugins: { legend: { display: false } }
        }
    });
}


/** Gemini ile kişiselleştirilmiş profil analiz metnini oluşturur */
async function generateProfileAnalysis() {
    const analysisContainer = document.getElementById('profile-analysis-text');
    
    const analysisLoaderHTML = `
        <div class="text-center p-4">
            <div class="relative w-20 h-20 mx-auto mb-4">
                <div class="absolute inset-0 rounded-full border-2 border-cyan-500/30 animate-pulse-loader-1"></div>
                <div class="absolute inset-0 rounded-full border-2 border-purple-500/30 animate-pulse-loader-2"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <svg class="w-8 h-8 text-cyan-300 animate-spin-slow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.293 2.293M17.707 5.293L15.414 7.586m-3.414.414L9.586 9.586m6.414 6.414l-2.293 2.293M12 12a2 2 0 100-4 2 2 0 000 4zm0 0a2 2 0 100 4 2 2 0 000-4z" />
                    </svg>
                </div>
            </div>
            <p class="tech-font text-lg text-cyan-200 animate-pulse">Analiziniz hazırlanıyor...</p>
            <p class="text-slate-400 text-sm">Lütfen ekrandan ayrılmayın.</p>
        </div>
    `;
    
    analysisContainer.innerHTML = analysisLoaderHTML;

    const sortedArchetypes = Object.entries(userArchetypeScores)
        .sort(([,a],[,b]) => b-a)
        .slice(0, 3)
        .map(([key, score]) => `${archetypes[key].tr.name}: ${score} puan`);
        
    const skillsSummary = Object.entries(creativitySkillsScores)
        .map(([key, score]) => `${creativitySkills[key].tr}: ${score}/5 puan`).join(', ');

    const prompt = `Bir yaratıcılık koçu olarak, bir kullanıcının yaratıcı zeka profili test sonuçlarını analiz et.
    Kullanıcının en yüksek puan aldığı ilk 3 mitolojik arketip şunlar: ${sortedArchetypes.join(', ')}.
    Kullanıcının kendi değerlendirmesine göre yaratıcılık becerileri dengesi şu şekilde: ${skillsSummary}.
    Bu iki veri setini birleştirerek, kullanıcının en güçlü 2-3 yaratıcı yönünü, bu yönlerin birbiriyle nasıl bir sinerji oluşturduğunu ve potansiyel gelişim alanlarını açıklayan, teşvik edici ve kişisel bir analiz metni yaz. Analizi 2-3 paragrafta özetle.`;

    try {
        const analysis = await callGeminiAPI(prompt);
        analysisContainer.innerHTML = `<p>${analysis}</p>`;
    } catch (error) {
        analysisContainer.innerHTML = `
            <div class="text-center text-amber-300 p-4 rounded-lg bg-amber-500/10 border border-amber-500/30">
                <p class="text-3xl mb-2 animate-pulse">📡</p>
                <p class="font-bold tech-font text-lg">SİNYAL KAYBI!</p>
                <p class="text-sm mt-1">Yapay zeka ile bağlantı kurulamadı (Hata: 401). Lütfen API anahtarınızı kontrol edin veya daha sonra tekrar deneyin.</p>
            </div>
        `;
    }
}

/** Aşama ismini döndürür */
function getStageName(stage) {
    if (stage === 1) return "Keşif";
    if (stage === 2) return "Sınama";
    if (stage === 3) return "Sentez";
    if (stage === 4) return "Öz-Değerlendirme";
    return "";
}

/** Arka plan yıldızlarını oluşturur */
function createStars() {
    const starsContainer = document.getElementById('stars');
    if (!starsContainer || starsContainer.children.length > 0) return;
    for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        const size = Math.random() * 2;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.left = `${Math.random() * 100}%`;
        star.style.animationDelay = `${Math.random() * 4}s`;
        star.style.animationDuration = `${3 + Math.random() * 3}s`;
        starsContainer.appendChild(star);
    }
}

/** Arketip kartlarını oluşturur */
function createArchetypeCards() {
    const container = document.getElementById('archetype-carousel');
    if (!container || container.children.length > 0) return; // Sadece bir kere oluştur
    
    let cardsHTML = '';
    for (const key in archetypes) {
        const archetype = archetypes[key];
        cardsHTML += `
            <div class="flex-shrink-0 w-full sm:w-1/2 lg:w-1/3 p-3">
                <div class="archetype-card h-full flex flex-col">
                    <div class="archetype-icon-container">
                        <svg viewBox="0 0 100 100" fill="none" stroke="currentColor">${archetype.icon}</svg>
                    </div>
                    <h4 class="tech-font text-purple-300 text-lg mb-2">${archetype.tr.name}</h4>
                    <p class="text-slate-400 text-sm leading-relaxed">${archetype.tr.desc}</p>
                </div>
            </div>
        `;
    }
    container.innerHTML = cardsHTML;
}

/** Arketip karuselini ayarlar */
function setupArchetypeCarousel() {
    const totalItems = Object.keys(archetypes).length;

    function getItemsPerPage() {
        if (window.innerWidth >= 1024) return 3;
        if (window.innerWidth >= 640) return 2;
        return 1;
    }

    function updateCarousel() {
        const itemsPerPage = getItemsPerPage();
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        
        if (archetypeCurrentIndex >= totalPages) {
            archetypeCurrentIndex = totalPages - 1;
        }
        if (archetypeCurrentIndex < 0) {
            archetypeCurrentIndex = 0;
        }

        const offset = -archetypeCurrentIndex * 100;
        archetypeCarousel.style.transform = `translateX(${offset}%)`;

        archetypePrevBtn.disabled = archetypeCurrentIndex === 0;
        archetypeNextBtn.disabled = archetypeCurrentIndex >= totalPages - 1;
    }

    archetypeNextBtn.addEventListener('click', () => {
        archetypeCurrentIndex++;
        updateCarousel();
    });

    archetypePrevBtn.addEventListener('click', () => {
        archetypeCurrentIndex--;
        updateCarousel();
    });

    window.addEventListener('resize', updateCarousel);
    updateCarousel();
}


/** 3D şekli başlatır */
function initAbstractShape() {
    const container = document.getElementById('abstract-shape-container');
    if (!container || container.children.length > 0) return;
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);
    const geometry = new THREE.TorusKnotGeometry(1, 0.3, 100, 16);
    const material = new THREE.MeshStandardMaterial({ color: 0x9333ea, metalness: 0.7, roughness: 0.2, emissive: 0x00f6ff, emissiveIntensity: 0.2 });
    const shape = new THREE.Mesh(geometry, material);
    scene.add(shape);
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    const pointLight = new THREE.PointLight(0xffffff, 1);
    pointLight.position.set(5, 5, 5);
    scene.add(pointLight);
    camera.position.z = 3.5;
    function animate() {
        requestAnimationFrame(animate);
        shape.rotation.x += 0.003;
        shape.rotation.y += 0.005;
        renderer.render(scene, camera);
    }
    animate();
}

function showScreen(screenId) {
    welcomeScreen.style.display = 'none';
    assessmentScreen.style.display = 'none';
    resultsScreen.style.display = 'none';
    document.getElementById(screenId).style.display = 'block';
}

/** Titreşim fonksiyonu */
function triggerVibration() {
    if ('vibrate' in navigator) {
        navigator.vibrate(50);
    }
}

// --- SESLİ ASİSTAN MANTIĞI --- //
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;
if(SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onstart = () => {
        voiceAssistantBtn.classList.add('listening');
    };

    recognition.onend = () => {
        voiceAssistantBtn.classList.remove('listening');
    };

    recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        voiceAssistantBtn.classList.remove('listening');
    };

    recognition.onresult = (event) => {
        const command = event.results[0][0].transcript.toLowerCase().trim();
        processVoiceCommand(command);
    };
}

let textToSpeechRecognition;
if(SpeechRecognition) {
    textToSpeechRecognition = new SpeechRecognition();
    textToSpeechRecognition.lang = 'tr-TR';
    textToSpeechRecognition.continuous = false;
    textToSpeechRecognition.interimResults = false;

    textToSpeechRecognition.onstart = () => {
        const btn = document.querySelector(`.speech-to-text-btn[data-target="${activeSpeechToTextInput}"]`);
        if (btn) btn.classList.add('listening');
    };

    textToSpeechRecognition.onend = () => {
        const btn = document.querySelector(`.speech-to-text-btn[data-target="${activeSpeechToTextInput}"]`);
        if (btn) btn.classList.remove('listening');
        activeSpeechToTextInput = null;
    };

    textToSpeechRecognition.onerror = (event) => {
        console.error('Text-to-speech recognition error:', event.error);
        const btn = document.querySelector(`.speech-to-text-btn[data-target="${activeSpeechToTextInput}"]`);
        if (btn) btn.classList.remove('listening');
    };

    textToSpeechRecognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        if (activeSpeechToTextInput) {
            const targetElement = document.querySelector(activeSpeechToTextInput) || document.getElementById(activeSpeechToTextInput);
            if(targetElement) {
                targetElement.value += transcript;
            }
        }
    };
}


function speak(text) {
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'tr-TR';
        utterance.rate = 1.1;
        window.speechSynthesis.speak(utterance);
    }
}

function processVoiceCommand(command) {
    console.log(`Command received: ${command}`);
    if (command.includes('ekranı oku')) {
        let textToRead = '';
        if (welcomeScreen.style.display !== 'none') {
            textToRead = "Giriş ekranındasınız. Başlık: Yaratıcı Zeka Profili. " + document.querySelector('[data-lang-key="welcome_intro"]').textContent;
        } else if (assessmentScreen.style.display !== 'none') {
            const title = moduleTitle.textContent;
            const instruction = moduleContentArea.querySelector('p')?.textContent || "Lütfen seçiminizi yapın.";
            textToRead = `Şu anki modül: ${title}. ${instruction}`;
        } else if (resultsScreen.style.display !== 'none') {
            const user = userNameResults.textContent;
            const analysis = profileAnalysisText.textContent;
            textToRead = `Sonuç ekranı. ${user} için yaratıcı profil. ${analysis}`;
        }
        speak(textToRead || "Okunacak bir içerik bulunamadı.");
    } else if (command.includes('test nedir') || command.includes('amaç ne')) {
        const aboutText = document.querySelector('#about-content').textContent;
        speak("Elbette, testin amacı hakkında bilgi veriyorum. " + aboutText);
    } else if (command.includes('arketipler nelerdir')) {
        const archetypeNames = Object.values(archetypes).map(a => a.tr.name).join(', ');
        speak(`Toplam 10 arketip bulunuyor: ${archetypeNames}. Detaylı bilgi için bir arketipin adını söyleyebilirsiniz.`);
    } else if (command.includes('nasıl başlarım')) {
        speak("Başlamak için adınızı yazın ve başla butonuna tıklayın.");
    } else if (command.includes('yardım')) {
        speak("Bana 'ekranı oku', 'test nedir', 'arketipler nelerdir', 'nasıl başlarım' veya belirli bir arketipin adını sorabilirsiniz. Örneğin, 'Stratejist arketipi nedir?'");
    } else {
        let found = false;
        for (const key in archetypes) {
            const archetype = archetypes[key];
            if (command.includes(archetype.tr.name.toLowerCase())) {
                speak(`${archetype.tr.name}: ${archetype.tr.desc}`);
                found = true;
                break;
            }
        }
        if (!found) {
            speak("Üzgünüm, bu komutu anlayamadım. 'Yardım' diyerek mevcut komutları öğrenebilirsiniz.");
        }
    }
}


// --- OLAY DİNLEYİCİLERİ (EVENT LISTENERS) --- //
document.addEventListener('DOMContentLoaded', () => {
    createStars();
    initAbstractShape();
    createArchetypeCards();
    setupArchetypeCarousel();
    showScreen('welcome-screen');
});

document.body.addEventListener('click', (e) => {
    if (e.target.closest('.vibrate-on-click')) {
        triggerVibration();
    }
    
    // Speech-to-text button handler
    const speechBtn = e.target.closest('.speech-to-text-btn');
    if (speechBtn && textToSpeechRecognition) {
        triggerVibration();
        activeSpeechToTextInput = speechBtn.dataset.target;
        try {
            textToSpeechRecognition.start();
        } catch(err) {
            console.error("Text-to-speech recognition already started.", err);
        }
    }
});

startAssessmentBtn.addEventListener('click', () => {
    const userName = userNameInput.value.trim();
    if (!userName) {
        nameError.classList.remove('hidden');
        userNameInput.classList.add('border-red-500');
        userNameInput.focus();
        return;
    }
    initializeApp();
});

userNameInput.addEventListener('input', () => {
    if (userNameInput.value.trim() !== '') {
        nameError.classList.add('hidden');
        userNameInput.classList.remove('border-red-500');
    }
});


btnNext.addEventListener('click', () => {
    const taskTextarea = document.querySelector(`textarea[data-module-index="${currentModuleIndex}"]`);
    if (taskTextarea) {
        userAnswers[currentModuleIndex] = taskTextarea.value;
    }

    if (currentModuleIndex < assessmentModules.length - 1) {
        currentModuleIndex++;
        loadModule(currentModuleIndex);
    } else {
        showResults();
    }
});

btnPrev.addEventListener('click', () => {
    if (currentModuleIndex > 0) {
        currentModuleIndex--;
        loadModule(currentModuleIndex);
    }
});

moduleContentArea.addEventListener('click', (e) => {
    const option = e.target.closest('.quiz-option, .rating-option');
    if (option) {
        triggerVibration();
        const container = option.parentElement;
        const moduleIndex = parseInt(container.dataset.moduleIndex);
        const value = option.classList.contains('quiz-option') 
            ? parseInt(option.dataset.optionIndex) 
            : parseInt(option.dataset.optionValue);
        
        userAnswers[moduleIndex] = value;
        
        container.querySelectorAll('.quiz-option, .rating-option').forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
    }

    const selectedShapeOption = e.target.closest('.shape-option');
    if (selectedShapeOption) {
        triggerVibration();
        const container = e.target.closest('#shape-options-container');
        const moduleIndex = parseInt(container.dataset.moduleIndex);
        const selectedIndex = parseInt(selectedShapeOption.dataset.optionIndex);
        userAnswers[moduleIndex] = selectedIndex;
        container.querySelectorAll('.shape-option').forEach(opt => opt.classList.remove('selected'));
        selectedShapeOption.classList.add('selected');
    }
});

btnMainMenu.addEventListener('click', () => showScreen('welcome-screen'));
btnRestart.addEventListener('click', () => {
    userNameInput.value = '';
    nameError.classList.add('hidden');
    userNameInput.classList.remove('border-red-500');
    showScreen('welcome-screen');
});

// Modal Logic
function openModal(initialTab) {
    modalTabButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === initialTab);
    });
    modalTabContents.forEach(content => {
        content.classList.toggle('active', content.id === `${initialTab}-content`);
    });
    infoModal.classList.add('active');
}

infoModalBtns.forEach(button => {
    button.addEventListener('click', () => {
        openModal(button.dataset.tab);
    });
});

closeModalBtn.addEventListener('click', () => {
    infoModal.classList.remove('active');
});

infoModal.addEventListener('click', (e) => {
    if (e.target === infoModal) {
        infoModal.classList.remove('active');
    }
});

modalTabButtons.forEach(button => {
    button.addEventListener('click', () => {
        const targetTab = button.dataset.tab;
        modalTabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        modalTabContents.forEach(content => {
            content.classList.toggle('active', content.id === `${targetTab}-content`);
        });
    });
});

// Voice Assistant Logic
voiceAssistantBtn.addEventListener('click', () => {
    if (recognition) {
        try {
            if(window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            recognition.start();
        } catch(e) {
            console.error("Recognition already started.", e);
        }
    } else {
        alert("Üzgünüz, tarayıcınız ses tanımayı desteklemiyor.");
    }
});

</script>
</body>
</html>
